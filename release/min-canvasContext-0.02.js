var canvasContext_prototype=function(){"use strict";var t=function(){!function(t){var i,n;t.arcTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.bezierCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.copyFrom=function(t){t.m&&(t=t.m);for(var i=this.m,n=!1,r=0;6>r;r++)i[r]!=t[r]&&(n=!0);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],n},t.fillStyle=function(t){this.setStyle("fillStyle",t)},t.font=function(t){var i=t.split(" ");this.setStyle("font-size",i[0]),this.setStyle("font-family",i[1])},t.getStyle=function(t){var i=this._fillState[this._fillState.length-1];return i?i[t]:void 0},t.getSvgTransform=function(){var t=this.m;return"matrix("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+")"},t.globalAlpha=function(t){this.setStyle("globalAlpha",t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(n={x:0,y:0}),this.reset(),this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0}}),t.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=this.m[3]*t,n=-this.m[1]*t,r=-this.m[2]*t,e=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=i,this.m[1]=n,this.m[2]=r,this.m[3]=e,this.m[4]=o,this.m[5]=s},t.lineTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.lineWidth=function(t){this.setStyle("lineWidth",t)},t.moveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.multiply=function(t){var i=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],e=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=i,this.m[1]=n,this.m[2]=r,this.m[3]=e,this.m[4]=o,this.m[5]=s},t.quadraticCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.reset=function(){if(this.m){var t=this.m;t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this._point.x=0,this._point.y=0,this._point.tx1=0,this._point.ty1=0,this._point.tx0=0,this._point.ty0=0}else this.m=[1,0,0,1,0,0],this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0};this._fillState=[{globalAlpha:1,fillStyle:"none",strokeStyle:"black","font-size":10,lineWidth:1,"font-family":"Arial"}]},t.restore=function(){this.m=this._oldies.pop(),this._fillState.pop()},t.rotate=function(t){var i=Math.cos(t),n=Math.sin(t),r=this.m[0]*i+this.m[2]*n,e=this.m[1]*i+this.m[3]*n,o=this.m[0]*-n+this.m[2]*i,s=this.m[1]*-n+this.m[3]*i;this.m[0]=r,this.m[1]=e,this.m[2]=o,this.m[3]=s},t.rotateAround=function(t,i,n){this.translate(t,i),this.rotate(n*Math.PI/180),this.translate(-t,-i)},t.save=function(){var t=this.m.slice(0);this._oldies||(this._oldies=[]),this._oldies.push(t);var i=this._fillState[this._fillState.length-1],n={};for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);this._fillState.push(n)},t.scale=function(t,i){isNaN(t)||isNaN(i)||(this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i)},t.setStyle=function(t,i){var n=this._fillState[this._fillState.length-1];n&&(n[t]=i)},t.strokeStyle=function(t){this.setStyle("strokeStyle",t)},t.transformDelta=function(t,i){return n.x=t*this.m[0]+i*this.m[2],n.y=t*this.m[1]+i*this.m[3],n},t.transformPoint=function(t,i){var r=t,e=i;return n.x=r*this.m[0]+e*this.m[2]+this.m[4],n.y=r*this.m[1]+e*this.m[3]+this.m[5],n},t.translate=function(t,i){this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i},t.translateAbsolute=function(t,i){this.m[4]=this.m[0]*t+this.m[2]*i,this.m[5]=this.m[1]*t+this.m[3]*i},t.updateContext=function(t){var i=this.m;t.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},t.xScaleFactor=function(){var t=this.m[0],i=this.m[2];return Math.sqrt(t*t+i*i)}}(this)},i=function(t,n,r,e,o,s,a,h){if(!(this instanceof i))return new i(t,n,r,e,o,s,a,h);var f=[t,n,r,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=i._classInfo.name)return new c(t,n,r,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"ocTransform"},i.prototype=new t;var n=function(){var t=function(){!function(t){var i,n,r,e,o;t.add=function(t,i,r){if(i||r){var e;"[object Array]"===Object.prototype.toString.call(r)?e=r:(e=Array.prototype.slice.call(arguments,2),e||(e=[])),n.push([i,t,e])}else n.push(t)},t.after=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),e[n]={step:Math.floor(1e3*t),fn:i,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),e[n]={step:Math.floor(1e3*t),fn:i,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!i){this.polyfill();var t,s;if("undefined"!=typeof window){var t=window.requestAnimationFrame,s=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(i){t||(t=window[i+"RequestAnimationFrame"],s=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),s||(s=function(t){clearTimeout(t)}),n=[],r={},e={},o=[];var a=0,h=function(){for(var i,s=(new Date).getTime();i=n.shift();)"[object Array]"===Object.prototype.toString.call(i)?i[1].apply(i[0],i[2]):i();for(var f=0;f<o.length;f++){var c=o[f];c()}for(var l in r)if(r.hasOwnProperty(l)){var u=r[l];u[0](u[1]),delete r[l]}for(var l in e)if(e.hasOwnProperty(l)){var u=e[l];u.nextTime<s&&(u.remove?u.nextTime>0?(u.fn(),delete e[l]):u.nextTime=s+u.step:(u.fn(),u.nextTime=s+u.step)),u.until&&u.until<s&&delete e[l]}t(h),a=s};h(),i=!0}}),t.once=function(t,i,n){r[t]=[i,n]},t.onFrame=function(t){o.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var i=o.indexOf(t);return i>=0?(t._onRemove&&t._onRemove(),o.splice(i,1),!0):!1}}(this)},i=function(t,n,r,e,o,s,a,h){if(!(this instanceof i))return new i(t,n,r,e,o,s,a,h);var f=[t,n,r,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=i._classInfo.name)return new c(t,n,r,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"later"},i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,e=0,o=[],s=new Array(n);return this.then(function(){var t=r();return 0==i.length&&t.resolve([]),i.forEach(function(i,r){i.then?(o.push(i),i.then(function(i){s[r]=i,e++,e==n&&t.resolve(s)},function(i){t.reject(i)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var e;e=this.isArray(i)?i:[i];var o=e.length,s=!1,a=!1,h=0,f=[],c=n||{};return this.then(function(){var i=r();return e.forEach(function(n){n.then?(f.push(n),n.then(function(n){h++,s=t(n,c),(s&&!a||0==a&&o==h)&&(i.resolve(c),a=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var i=this._childPromises.length;i--;){var n=this._childPromises.shift();if(n._onFulfill)try{var r=n._onFulfill(t);"undefined"!=typeof r?n.resolve(r):n.fulfill(t)}catch(e){n.reject(e)}else n.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=r();return this.then(function(){var r=Array.prototype.slice.call(arguments,0),e=t.concat(r),o=i.apply(this,e);n.resolve(o)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(n)&&(this._onReject=n),!n&&this.isFunction(t)){var r=this;i().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){r.resolve(t)},function(t){r.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,i){this.plugin(t,function(){var t,n,r=Array.prototype.slice.call(arguments,0),e=0;r.length>=0&&(t=r[r.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(n=t,e=r.length-1));var o=wishes().pending();return this.then(function(){var t=wishes().pending(),s=Array.prototype.slice.call(arguments,0);console.log("Orig args",r),console.log("Then args",s);var a;0==r.length&&(a=s),0==s.length&&(a=r),a||(a=s.concat(r)),e=a.length,n&&e--,a[e]=function(i){if(i)return console.log("Got error ",i),t.reject(i),void o.reject(i);if(n){var r=Array.prototype.slice.call(arguments),e=n.apply(this,r);o.resolve(e)}else{var r=Array.prototype.slice.call(arguments,1);o.resolve.apply(o,r)}},t.then(function(t){o.resolve(t)}),console.log("nodeStyle after concat",a);i.apply(this,a);return t},function(t){o.reject(t)}),o})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(i,n){return t[i]=n,this},t.props=function(t){var i=[];for(var n in t)t.hasOwnProperty(n)&&i.push({name:n,promise:t[n]});var r=i.length,e=0,o=[],s={};return this.then(function(){var t=wishes().pending();return i.forEach(function(i){var n=i.promise,a=i.name;n.then?(o.push(n),n.then(function(i){s[a]=i,e++,e==r&&t.resolve(s)},function(i){t.reject(i)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var i=this._childPromises.length;i--;){var n=this._childPromises.shift();if(n._onReject)try{n._onReject(t),n.reject(t)}catch(r){n.reject(r)}else n.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var i=this;t.onStateChange(function(){1==t._state&&i.resolve(t.value()),2==t._state&&i.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var n=!1;try{var i=this;t.then.call(t,function(t){n||(i.resolve(t),n=!0)},function(t){n||(i.reject(t),n=!0)})}catch(r){n||this.reject(r)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var e=new r(t,n),o=this;return 1==this._state&&i().asap(function(){o.fulfill(o.value())}),2==this._state&&ater().asap(function(){o.reject(o.rejectReason())}),this._childPromises.push(e),e},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(i){i(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},r=function(t,i,n,e,o,s,a,h){if(!(this instanceof r))return new r(t,i,n,e,o,s,a,h);var f=[t,i,n,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=r._classInfo.name)return new c(t,i,n,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"_promise"},r.prototype=new n,"undefined"!=typeof window&&(window._promise=r),"undefined"!=typeof window&&(window._promise_prototype=n);var e=function(){!function(t){var i,n,r,e,o;t.add=function(t,i,r){if(i||r){var e;"[object Array]"===Object.prototype.toString.call(r)?e=r:(e=Array.prototype.slice.call(arguments,2),e||(e=[])),n.push([i,t,e])}else n.push(t)},t.after=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),e[n]={step:Math.floor(1e3*t),fn:i,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),e[n]={step:Math.floor(1e3*t),fn:i,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!i){this.polyfill();var t,s;if("undefined"!=typeof window){var t=window.requestAnimationFrame,s=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(i){t||(t=window[i+"RequestAnimationFrame"],s=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),s||(s=function(t){clearTimeout(t)}),n=[],r={},e={},o=[];var a=0,h=function(){for(var i,s=(new Date).getTime();i=n.shift();)"[object Array]"===Object.prototype.toString.call(i)?i[1].apply(i[0],i[2]):i();for(var f=0;f<o.length;f++){var c=o[f];c()}for(var l in r)if(r.hasOwnProperty(l)){var u=r[l];u[0](u[1]),delete r[l]}for(var l in e)if(e.hasOwnProperty(l)){var u=e[l];u.nextTime<s&&(u.remove?u.nextTime>0?(u.fn(),delete e[l]):u.nextTime=s+u.step:(u.fn(),u.nextTime=s+u.step)),u.until&&u.until<s&&delete e[l]}t(h),a=s};h(),i=!0}}),t.once=function(t,i,n){r[t]=[i,n]},t.onFrame=function(t){o.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var i=o.indexOf(t);return i>=0?(t._onRemove&&t._onRemove(),o.splice(i,1),!0):!1}}(this)},o=function(t,i,n,r,e,s,a,h){if(!(this instanceof o))return new o(t,i,n,r,e,s,a,h);var f=[t,i,n,r,e,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=o._classInfo.name)return new c(t,i,n,r,e,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};o._classInfo={name:"later"},o.prototype=new e,"undefined"!=typeof window&&(window.later=o),"undefined"!=typeof window&&(window.later_prototype=e);var s=function(){var t=function(){!function(t){var i,n,r,e,o,s,a,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var n=this.normalize({x:t.x,y:t.y}),r=this.normalize({x:i.x,y:i.y}),e=this.crossProd(n,r),o=this.dotProd(n,r),s=Math.acos(o);return 0>e&&(s=-1*s),s},t.calc_cat=function(t,i,n,r,e){var o=t*t,s=o*t;return.5*(2*n+(-i+r)*t+(2*i-5*n+4*r-e)*o+(-i+3*n-3*r+e)*s)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var n=t.x-i.x,r=t.y-i.y;return Math.sqrt(n*n+r*r)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,n){var r=a;return r.A=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),r.sign=r.A<0?-1:1,r.s1=(t.y*n.x-t.x*n.y+(n.y-t.y))*r.sign,r.s2=(n.y-t.y)*r.sign,r.s3=(t.x-n.x)*r.sign,r.t1=(t.x*i.y-t.y*i.x)*r.sign,r.t2=(t.y-i.y)*r.sign,r.t3=(i.x-t.x)*r.sign,r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},s={x:0,y:0},i=[0,0,0,0],n={x:0,y:0},r={x:0,y:0},e={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){r.y=i.y-t.y,r.x=i.x-t.x,n.y=r.y,n.x=r.x,this.normalize(r),this.normalize(n),this.rotate(n,Math.PI/2),e.x=t.x,e.y=t.y},t.length=function(t){var i=t.x,n=t.y;return Math.sqrt(i*i+n*n)},t.linesIntersect=function(t,i,n,r){var e=t.x,o=t.y,s=i.x,a=i.y,h=n.x,f=n.y,c=r.x,l=r.y,u=((e*a-o*s)*(h-c)-(e-s)*(h*l-f*c))/((e-s)*(f-l)-(o-a)*(h-c)),y=((e*a-o*s)*(f-l)-(o-a)*(h*l-f*c))/((e-s)*(f-l)-(o-a)*(h-c));if(isNaN(u)||isNaN(y))return!1;if(e>=s){if(!(u>=s&&e>=u))return!1}else if(!(u>=e&&s>=u))return!1;if(o>=a){if(!(y>=a&&o>=y))return!1}else if(!(y>=o&&a>=y))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(y>=l&&f>=y))return!1}else if(!(y>=f&&l>=y))return!1;return!0},t.mirrorVector=function(t,i,n){o.x=i.x-n.x,o.y=i.y-n.y,s.x=-o.y,s.y=o.x,t.x=t.x-n.x,t.y=t.y-n.y,this.dotProd(t,s)>0&&this.rotate(s,Math.PI),this.normalize(o),this.normalize(s);var r=Math.abs(this.dotProd(t,s)),e=this.dotProd(t,o);return t.x=s.x*r+o.x*e,t.y=s.y*r+o.y*e,t.x+=n.x,t.y+=n.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,s.x=-o.y,s.y=o.x,this.normalize(o),this.normalize(s),this.rotate(o,Math.PI);var n=Math.abs(jsMath.dotProd(t,s)),r=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,s)<0&&this.rotate(s,Math.PI),t.x=s.x*n+o.x*r,t.y=s.y*n+o.y*r,t},t.pointInTriangle=function(t,i,n,r){var e=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),o=0>e?-1:1,s=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*o,a=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*o;return s>0&&a>0&&2*e*o>s+a},t.pointInTriangleBc=function(t,i){var n=i.A,r=i.sign,e=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return e>0&&o>0&&2*n*r>e+o},t.project=function(t){var i=t;return pVector.x=i.x-e.x,pVector.y=i.y-e.y,prodResult.i=this.dotProd(pVector,r),prodResult.j=this.dotProd(pVector,n),prodResult},t.rotate=function(t,i){var n=Math.sin(i),r=Math.cos(i),e=t.x,o=t.y;return t.x=e*r+o*n,t.y=-e*n+o*r,t},t.rotateAround=function(t,i,n){this.sub(i,n),this.rotate(i,t),this.add(i,n)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,n){var r={};r.x=i.x-t.x,r.y=i.y-t.y;var e={};e.x=n.x-i.x,e.y=n.y-i.y;var o={x:r.x+e.x,y:r.y+e.y};return this.normalize(o)},t.triangleArea=function(t,i,n){var r=t.x*(i.y-n.y)+i.x*(n.y-t.y)+n.x*(t.y-i.y);return Math.abs(r/2)},t.triangleInTriangle=function(t,i,n,r,e,o){var s=this.getBarCoeffs(t,i,n);if(this.pointInTriangleBc(r,s))return!0;if(this.pointInTriangleBc(e,s))return!0;if(this.pointInTriangleBc(o,s))return!0;var s=this.getBarCoeffs(r,e,o);return this.pointInTriangleBc(t,s)?!0:this.pointInTriangleBc(i,s)?!0:this.pointInTriangleBc(n,s)?!0:this.linesIntersect(t,i,r,e)?!0:this.linesIntersect(i,n,r,e)?!0:this.linesIntersect(n,t,r,e)?!0:this.linesIntersect(t,i,e,o)?!0:this.linesIntersect(i,n,e,o)?!0:this.linesIntersect(n,t,e,o)?!0:this.linesIntersect(t,i,o,r)?!0:this.linesIntersect(i,n,o,r)?!0:this.linesIntersect(n,t,o,r)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*r.x+i.j*n.x,h.y=i.i*r.y+i.j*n.y,h.x+=e.x,h.y+=e.y,h}}(this)},i=function(t,n,r,e,o,s,a,h){if(!(this instanceof i))return new i(t,n,r,e,o,s,a,h);var f=[t,n,r,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=i._classInfo.name)return new c(t,n,r,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"jsVectors"},i.prototype=new t,"undefined"!=typeof window&&(window.jsVectors=i),"undefined"!=typeof window&&(window.jsVectors_prototype=t);var n=function(){var t=function(){!function(t){var i,n,r,e,o,s,a,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var n=this.normalize({x:t.x,y:t.y}),r=this.normalize({x:i.x,y:i.y}),e=this.crossProd(n,r),o=this.dotProd(n,r),s=Math.acos(o);return 0>e&&(s=-1*s),s},t.calc_cat=function(t,i,n,r,e){var o=t*t,s=o*t;return.5*(2*n+(-i+r)*t+(2*i-5*n+4*r-e)*o+(-i+3*n-3*r+e)*s)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var n=t.x-i.x,r=t.y-i.y;return Math.sqrt(n*n+r*r)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,n){var r=a;return r.A=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),r.sign=r.A<0?-1:1,r.s1=(t.y*n.x-t.x*n.y+(n.y-t.y))*r.sign,r.s2=(n.y-t.y)*r.sign,r.s3=(t.x-n.x)*r.sign,r.t1=(t.x*i.y-t.y*i.x)*r.sign,r.t2=(t.y-i.y)*r.sign,r.t3=(i.x-t.x)*r.sign,r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},s={x:0,y:0},i=[0,0,0,0],n={x:0,y:0},r={x:0,y:0},e={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){r.y=i.y-t.y,r.x=i.x-t.x,n.y=r.y,n.x=r.x,this.normalize(r),this.normalize(n),this.rotate(n,Math.PI/2),e.x=t.x,e.y=t.y},t.length=function(t){var i=t.x,n=t.y;return Math.sqrt(i*i+n*n)},t.linesIntersect=function(t,i,n,r){var e=t.x,o=t.y,s=i.x,a=i.y,h=n.x,f=n.y,c=r.x,l=r.y,u=((e*a-o*s)*(h-c)-(e-s)*(h*l-f*c))/((e-s)*(f-l)-(o-a)*(h-c)),y=((e*a-o*s)*(f-l)-(o-a)*(h*l-f*c))/((e-s)*(f-l)-(o-a)*(h-c));if(isNaN(u)||isNaN(y))return!1;if(e>=s){if(!(u>=s&&e>=u))return!1}else if(!(u>=e&&s>=u))return!1;if(o>=a){if(!(y>=a&&o>=y))return!1}else if(!(y>=o&&a>=y))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(y>=l&&f>=y))return!1}else if(!(y>=f&&l>=y))return!1;return!0},t.mirrorVector=function(t,i,n){o.x=i.x-n.x,o.y=i.y-n.y,s.x=-o.y,s.y=o.x,t.x=t.x-n.x,t.y=t.y-n.y,this.dotProd(t,s)>0&&this.rotate(s,Math.PI),this.normalize(o),this.normalize(s);var r=Math.abs(this.dotProd(t,s)),e=this.dotProd(t,o);return t.x=s.x*r+o.x*e,t.y=s.y*r+o.y*e,t.x+=n.x,t.y+=n.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,s.x=-o.y,s.y=o.x,this.normalize(o),this.normalize(s),this.rotate(o,Math.PI);var n=Math.abs(jsMath.dotProd(t,s)),r=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,s)<0&&this.rotate(s,Math.PI),t.x=s.x*n+o.x*r,t.y=s.y*n+o.y*r,t},t.pointInTriangle=function(t,i,n,r){var e=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),o=0>e?-1:1,s=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*o,a=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*o;return s>0&&a>0&&2*e*o>s+a},t.pointInTriangleBc=function(t,i){var n=i.A,r=i.sign,e=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return e>0&&o>0&&2*n*r>e+o},t.project=function(t){var i=t;return pVector.x=i.x-e.x,pVector.y=i.y-e.y,prodResult.i=this.dotProd(pVector,r),prodResult.j=this.dotProd(pVector,n),prodResult},t.rotate=function(t,i){var n=Math.sin(i),r=Math.cos(i),e=t.x,o=t.y;return t.x=e*r+o*n,t.y=-e*n+o*r,t},t.rotateAround=function(t,i,n){this.sub(i,n),this.rotate(i,t),this.add(i,n)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,n){var r={};r.x=i.x-t.x,r.y=i.y-t.y;var e={};e.x=n.x-i.x,e.y=n.y-i.y;var o={x:r.x+e.x,y:r.y+e.y};return this.normalize(o)},t.triangleArea=function(t,i,n){var r=t.x*(i.y-n.y)+i.x*(n.y-t.y)+n.x*(t.y-i.y);return Math.abs(r/2)},t.triangleInTriangle=function(t,i,n,r,e,o){var s=this.getBarCoeffs(t,i,n);if(this.pointInTriangleBc(r,s))return!0;if(this.pointInTriangleBc(e,s))return!0;if(this.pointInTriangleBc(o,s))return!0;var s=this.getBarCoeffs(r,e,o);return this.pointInTriangleBc(t,s)?!0:this.pointInTriangleBc(i,s)?!0:this.pointInTriangleBc(n,s)?!0:this.linesIntersect(t,i,r,e)?!0:this.linesIntersect(i,n,r,e)?!0:this.linesIntersect(n,t,r,e)?!0:this.linesIntersect(t,i,e,o)?!0:this.linesIntersect(i,n,e,o)?!0:this.linesIntersect(n,t,e,o)?!0:this.linesIntersect(t,i,o,r)?!0:this.linesIntersect(i,n,o,r)?!0:this.linesIntersect(n,t,o,r)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*r.x+i.j*n.x,h.y=i.i*r.y+i.j*n.y,h.x+=e.x,h.y+=e.y,h}}(this)},i=function(t,n,r,e,o,s,a,h){if(!(this instanceof i))return new i(t,n,r,e,o,s,a,h);var f=[t,n,r,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=i._classInfo.name)return new c(t,n,r,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"jsVectors"},i.prototype=new t,"undefined"!=typeof window&&(window.jsVectors=i),"undefined"!=typeof window&&(window.jsVectors_prototype=t),function(t){t.copy=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,n,r){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0!==r?r:1}),t.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.multiply=function(t,i){i||(i=t,t=this);var n=t.x*i.w+t.y*i.z-t.z*i.y+t.w*i.x,r=-t.x*i.z+t.y*i.w+t.z*i.x+t.w*i.y,e=t.x*i.y-t.y*i.x+t.z*i.w+t.w*i.z,o=-t.x*i.x-t.y*i.y-t.z*i.z+t.w*i.w;return this.x=n,this.y=r,this.z=e,this.w=o,this},t.normalizeVector3D=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i||isNaN(i)?{x:1,y:0,z:0}:{x:t.x/i,y:t.y/i,z:t.z/i}},t.projectVector=function(t){var i={x:0,y:0,z:0},n=t.x,r=t.y,e=t.z,o=this.x,s=this.y,a=this.z,h=this.w,f=h*n+s*e-a*r,c=h*r+a*n-o*e,l=h*e+o*r-s*n,u=-o*n-s*r-a*e;return i.x=f*h+u*-o+c*-a-l*-s,i.y=c*h+u*-s+l*-o-f*-a,i.z=l*h+u*-a+f*-s-c*-o,i},t.rotate=function(t){return this.setFromAxisRotation({x:0,y:0,z:1},t),this},t.setFromAxisRotation=function(t,i){t=this.normalizeVector3D(t);var n=i/2,r=Math.sin(n);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(n),this}}(this)},r=function(t,i,n,e,o,s,a,h){if(!(this instanceof r))return new r(t,i,n,e,o,s,a,h);var f=[t,i,n,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=r._classInfo.name)return new c(t,i,n,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};r._classInfo={name:"quaternion"},r.prototype=new n,"undefined"!=typeof window&&(window.quaternion=r),"undefined"!=typeof window&&(window.quaternion_prototype=n);var e=function(){!function(t){var n;t.derivate=function(t,i){var n=this._points[t][0],r=this._points[t][1],e=this._points[t][2],o=this._points[t][3],s=i*i,a=1-i,h=a*a,f=3*h*(r-n)+6*i*a*(e-r)+3*s*(o-e);return f},t.distanceOf=function(t,i){var n=this.findClosestT(t,i),r=this.x(n)-t,e=this.y(n)-i;return Math.sqrt(r*r+e*e)},t.findClosestT=function(t,i){for(var n=0,r=.5,e=1,o=10;o--;){var s=this.x(n)-t,a=this.y(n)-i,h=this.x(e)-t,f=this.y(e)-i,c=Math.sqrt(s*s+a*a),l=Math.sqrt(h*h+f*f);l>c?e=r:n=r,r=n+(e-n)/2}var s=this.x(n)-t,a=this.y(n)-i,u=this.x(r)-t,y=this.y(r)-i;h=this.x(e)-t,f=this.y(e)-i;var c=Math.sqrt(s*s+a*a),p=Math.sqrt(u*u+y*y),l=Math.sqrt(h*h+f*f);return p>c&&l>c?n:p>l&&c>l?e:r},t.fitListTo=function(t){{var i={x:t[0].point_x(0),y:t[0].point_y(0)},r=t.length-1,e={x:t[r].point_x(3),y:t[r].point_y(3)},o={x:this.x(0),y:this.y(0)},s={x:this.x(1),y:this.y(1)},a=s.x-o.x,h=s.y-o.y,f=(Math.sqrt(a*a+h*h),e.x-i.x),c=e.y-i.y;Math.sqrt(f*f+c*c),n.angleBetween({x:a,y:h},{x:f,y:c})}},t.fromLine=function(t,i){var n=i.x-t.x,r=n/3;this.initCoeffs(0,t.x,t.x+r,t.x+2*r,i.x);var n=i.y-t.y,r=n/3;this.initCoeffs(1,t.y,t.y+r,t.y+2*r,i.y)},t.fromPoints=function(t,i,n,r){this.initCoeffs(0,t.x,i.x,n.x,r.x),this.initCoeffs(1,t.y,i.y,n.y,r.y)},t.fromQuadCurve=function(t,i,n){this.initCoeffs(0,t.x,t.x+2/3*(i.x-t.x),n.x+2/3*(i.x-n.x),n.x),this.initCoeffs(0,t.y,t.y+2/3*(i.y-t.y),n.y+2/3*(i.y-n.y),n.y)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._points=[],this._m=[],n||(n=i())}),t.initCoeffs=function(t,i,n,r,e){this._coeffs||(this._coeffs=[]),this._coeffs[t]||(this._coeffs[t]=[]),this._points[t]||(this._points[t]=[]),this._points[t][0]=i,this._points[t][1]=n,this._points[t][2]=r,this._points[t][3]=e;var o=this._coeffs[t];o[0]=3*(n-i),o[1]=3*(r-n)-o[0],o[2]=e-i-o[0]-o[1],o[3]=i},t.inverseProject=function(t){var i=t.t,n=this.normal(i,!0),r=n.x*t.nvProd+this.x(i),e=n.y*t.nvProd+this.y(i),o=this.tangent(i,!0);r+=t.tangetProd*o.x,e+=t.tangetProd*o.y,t.ix=r,t.iy=e},t.mirrorControls=function(){var t={x:this._points[0][0],y:this._points[1][0]},i={x:this._points[0][3],y:this._points[1][3]},r={x:this._points[0][1],y:this._points[1][1]},e={x:this._points[0][2],y:this._points[1][2]};n.mirrorVector(r,i,t),n.mirrorVector(e,i,t),this.initCoeffs(0,t.x,r.x,e.x,i.x),this.initCoeffs(1,t.y,r.y,e.y,i.y)},t.normal=function(t,i){var r=this.tangent(t),e=r.x;return r.x=-r.y,r.y=e,i&&n.normalize(r),r},t.point_x=function(t){return this._points[0][t]},t.point_y=function(t){return this._points[1][t]},t.points=function(){return this._m},t.projectPoint=function(t,i,n){for(var r=20,e=.5,o=.25;r--;){var s=this.tangent(e,!0);dv.x=t-this.x(e),dv.y=i-this.y(e);var a=dv.x*s.x+dv.y*s.y;if(Math.abs(a)<.05)break;e+=a>0?o:-o,o/=2}var h=this.normal(e,!0);return n||(n={}),n.tangentProd=a,n.nvProd=h.x*dv.x+h.y*d.y,n.nv_x=h.x,n.nv_y=h.y,n.tn_x=s.x,n.tn_y=s.y,n.ix=0,n.iy=0,n.t=e,n},t.setControls=function(t,i,n,r){this.initCoeffs(0,t.x,i.x,n.x,r.x),this.initCoeffs(1,t.y,i.y,n.y,r.y)},t.split=function(t){var i=this._points[0],n=this.splitCoeff(i[0],i[1],i[2],i[3],t);i=this._points[1];var r=this.splitCoeff(i[0],i[1],i[2],i[3],t);this.fromPoints({x:n.p0,y:r.p0},{x:n.p1,y:r.p1},{x:n.p2,y:r.p2},{x:n.p3,y:r.p3});var e=o();return e.fromPoints({x:n.p3,y:r.p3},{x:n.p4,y:r.p4},{x:n.p5,y:r.p5},{x:n.p6,y:r.p6}),e},t.splitCoeff=function(t,i,n,r,e){var o={};o.p0=t,o.p1=(1-e)*t+e*i;var s=(1-e)*i+e*n;return o.p5=(1-e)*n+e*r,o.p2=(1-e)*o.p1+e*s,o.p4=(1-e)*s+e*o.p5,o.p3=(1-e)*o.p2+e*o.p4,o.p6=r,o},t.step=function(t,i){if(this._coeffs){var n=this._coeffs[i];if(n){var r=t*t,e=r*t;return n[2]*e+n[1]*r+n[0]*t+n[3]}}},t.tangent=function(t,i){var r={};return r.x=this.derivate(0,t),r.y=this.derivate(1,t),i&&n.normalize(r),r},t.x=function(t){return this.step(t,0)},t.y=function(t){return this.step(t,1)},t.z=function(t){return this.step(t,2)}}(this)},o=function(t,i,n,r,e,s,a,h){if(!(this instanceof o))return new o(t,i,n,r,e,s,a,h);var f=[t,i,n,r,e,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)
}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=o._classInfo.name)return new c(t,i,n,r,e,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};o._classInfo={name:"jsBezierCurve"},o.prototype=new e,"undefined"!=typeof window&&(window.jsBezierCurve=o),"undefined"!=typeof window&&(window.jsBezierCurve_prototype=e);var s=function(){var t=function(){!function(t){var i,n,r,e,o,s,a,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var n=this.normalize({x:t.x,y:t.y}),r=this.normalize({x:i.x,y:i.y}),e=this.crossProd(n,r),o=this.dotProd(n,r),s=Math.acos(o);return 0>e&&(s=-1*s),s},t.calc_cat=function(t,i,n,r,e){var o=t*t,s=o*t;return.5*(2*n+(-i+r)*t+(2*i-5*n+4*r-e)*o+(-i+3*n-3*r+e)*s)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var n=t.x-i.x,r=t.y-i.y;return Math.sqrt(n*n+r*r)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,n){var r=a;return r.A=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),r.sign=r.A<0?-1:1,r.s1=(t.y*n.x-t.x*n.y+(n.y-t.y))*r.sign,r.s2=(n.y-t.y)*r.sign,r.s3=(t.x-n.x)*r.sign,r.t1=(t.x*i.y-t.y*i.x)*r.sign,r.t2=(t.y-i.y)*r.sign,r.t3=(i.x-t.x)*r.sign,r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},s={x:0,y:0},i=[0,0,0,0],n={x:0,y:0},r={x:0,y:0},e={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){r.y=i.y-t.y,r.x=i.x-t.x,n.y=r.y,n.x=r.x,this.normalize(r),this.normalize(n),this.rotate(n,Math.PI/2),e.x=t.x,e.y=t.y},t.length=function(t){var i=t.x,n=t.y;return Math.sqrt(i*i+n*n)},t.linesIntersect=function(t,i,n,r){var e=t.x,o=t.y,s=i.x,a=i.y,h=n.x,f=n.y,c=r.x,l=r.y,u=((e*a-o*s)*(h-c)-(e-s)*(h*l-f*c))/((e-s)*(f-l)-(o-a)*(h-c)),y=((e*a-o*s)*(f-l)-(o-a)*(h*l-f*c))/((e-s)*(f-l)-(o-a)*(h-c));if(isNaN(u)||isNaN(y))return!1;if(e>=s){if(!(u>=s&&e>=u))return!1}else if(!(u>=e&&s>=u))return!1;if(o>=a){if(!(y>=a&&o>=y))return!1}else if(!(y>=o&&a>=y))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(y>=l&&f>=y))return!1}else if(!(y>=f&&l>=y))return!1;return!0},t.mirrorVector=function(t,i,n){o.x=i.x-n.x,o.y=i.y-n.y,s.x=-o.y,s.y=o.x,t.x=t.x-n.x,t.y=t.y-n.y,this.dotProd(t,s)>0&&this.rotate(s,Math.PI),this.normalize(o),this.normalize(s);var r=Math.abs(this.dotProd(t,s)),e=this.dotProd(t,o);return t.x=s.x*r+o.x*e,t.y=s.y*r+o.y*e,t.x+=n.x,t.y+=n.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,s.x=-o.y,s.y=o.x,this.normalize(o),this.normalize(s),this.rotate(o,Math.PI);var n=Math.abs(jsMath.dotProd(t,s)),r=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,s)<0&&this.rotate(s,Math.PI),t.x=s.x*n+o.x*r,t.y=s.y*n+o.y*r,t},t.pointInTriangle=function(t,i,n,r){var e=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),o=0>e?-1:1,s=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*o,a=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*o;return s>0&&a>0&&2*e*o>s+a},t.pointInTriangleBc=function(t,i){var n=i.A,r=i.sign,e=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return e>0&&o>0&&2*n*r>e+o},t.project=function(t){var i=t;return pVector.x=i.x-e.x,pVector.y=i.y-e.y,prodResult.i=this.dotProd(pVector,r),prodResult.j=this.dotProd(pVector,n),prodResult},t.rotate=function(t,i){var n=Math.sin(i),r=Math.cos(i),e=t.x,o=t.y;return t.x=e*r+o*n,t.y=-e*n+o*r,t},t.rotateAround=function(t,i,n){this.sub(i,n),this.rotate(i,t),this.add(i,n)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,n){var r={};r.x=i.x-t.x,r.y=i.y-t.y;var e={};e.x=n.x-i.x,e.y=n.y-i.y;var o={x:r.x+e.x,y:r.y+e.y};return this.normalize(o)},t.triangleArea=function(t,i,n){var r=t.x*(i.y-n.y)+i.x*(n.y-t.y)+n.x*(t.y-i.y);return Math.abs(r/2)},t.triangleInTriangle=function(t,i,n,r,e,o){var s=this.getBarCoeffs(t,i,n);if(this.pointInTriangleBc(r,s))return!0;if(this.pointInTriangleBc(e,s))return!0;if(this.pointInTriangleBc(o,s))return!0;var s=this.getBarCoeffs(r,e,o);return this.pointInTriangleBc(t,s)?!0:this.pointInTriangleBc(i,s)?!0:this.pointInTriangleBc(n,s)?!0:this.linesIntersect(t,i,r,e)?!0:this.linesIntersect(i,n,r,e)?!0:this.linesIntersect(n,t,r,e)?!0:this.linesIntersect(t,i,e,o)?!0:this.linesIntersect(i,n,e,o)?!0:this.linesIntersect(n,t,e,o)?!0:this.linesIntersect(t,i,o,r)?!0:this.linesIntersect(i,n,o,r)?!0:this.linesIntersect(n,t,o,r)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*r.x+i.j*n.x,h.y=i.i*r.y+i.j*n.y,h.x+=e.x,h.y+=e.y,h}}(this)},i=function(t,n,r,e,o,s,a,h){if(!(this instanceof i))return new i(t,n,r,e,o,s,a,h);var f=[t,n,r,e,o,s,a,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=i._classInfo.name)return new c(t,n,r,e,o,s,a,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};i._classInfo={name:"jsVectors"},i.prototype=new t,"undefined"!=typeof window&&(window.jsVectors=i),"undefined"!=typeof window&&(window.jsVectors_prototype=t),function(t){t.bezierSplit=function(t,i,n,r,e){var o={};o.p1=(1-e)*t+e*i;var s=(1-e)*i+e*n;return o.p5=(1-e)*n+e*r,o.p2=(1-e)*o.p1+e*s,o.p4=(1-e)*s+e*o.p5,o.p3=(1-e)*o.p2+e*o.p4,o},t.endPoint=function(t,i,n){t||(t={x:0,y:0,z:0}),i||(i=r());var e=0;return n||(n=function(t){return t}),this.list.forEach(function(r){if(e++,"Q"==r.cmd){var o=0;r.path.forEach(function(r){r=n(r);var e={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(e);t.x+=s.x,t.y+=s.y,t.z+=s.z,o++})}if("M"==r.cmd&&r.path.forEach(function(r){r=n(r);var e={x:r.d,y:0,z:0};i.multiply(r.q);var o=i.projectVector(e);t.x+=o.x,t.y+=o.y,t.z+=o.z}),"L"==r.cmd&&r.path.forEach(function(r){r=n(r);var e={x:r.d,y:0,z:0};i.multiply(r.q);var o=i.projectVector(e);t.x+=o.x,t.y+=o.y,t.z+=o.z}),"C"==r.cmd){var o=0;r.path.forEach(function(r){r=n(r);var e={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(e);t.x+=s.x,t.y+=s.y,t.z+=s.z,o++})}}),t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this.list=t}),t.partToSvgPath=function(t,i,n,e){var o="";n||(n={x:0,y:0,z:0}),e||(e=r()),this.addedObjects=[];var s=this,a=0;return this.list.forEach(function(r){if(a++,!(t>a||a>i)){var h=_e("g");if(h.circle().attr({fill:"#ffaa88",cx:n.x,cy:n.y,r:10}),h.svg_text().attr({x:n.x,y:n.y+10,"font-size":20,fill:"black"}).text(a+""),s.addedObjects.push(h),"Q"==r.cmd){var f=0;r.path.forEach(function(t){var i={x:t.d,y:0,z:0};e.multiply(t.q);var r=e.projectVector(i);n.x+=r.x,n.y+=r.y,n.z+=r.z,0==f&&(o+="Q "),o+=" "+n.x.toFixed(3)+", "+n.y.toFixed(3),f++})}if("M"==r.cmd&&r.path.forEach(function(t){var i={x:t.d,y:0,z:0};e.multiply(t.q);var r=e.projectVector(i);n.x+=r.x,n.y+=r.y,n.z+=r.z,o+="M "+n.x.toFixed(3)+", "+n.y.toFixed(3)}),"L"==r.cmd&&r.path.forEach(function(t){var i={x:t.d,y:0,z:0};e.multiply(t.q);var r=e.projectVector(i);n.x+=r.x,n.y+=r.y,n.z+=r.z,o+="L "+n.x.toFixed(3)+", "+n.y.toFixed(3)}),"C"==r.cmd){var f=0;r.path.forEach(function(t){var i={x:t.d,y:0,z:0};e.multiply(t.q);var r=e.projectVector(i);n.x+=r.x,n.y+=r.y,n.z+=r.z,0==f&&(o+="C "),o+=" "+n.x.toFixed(3)+", "+n.y.toFixed(3),f++})}}}),o},t.pathFunction=function(){},t.quadToCubic=function(t,i,n){return{p0:t,p1:t+2/3*(i-t),p2:n+2/3*(i-n),p3:n}},t.toSvgCubicPath=function(t,i){var n="";t||(t={x:0,y:0,z:0}),i||(i=r());var e=0;return this.list.forEach(function(r){var o={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z,n+=0==e?"C "+t.x.toFixed(3)+", "+t.y.toFixed(3):" "+t.x.toFixed(3)+", "+t.y.toFixed(3),e++}),n},t.toSvgPath=function(t,i,n){var e="";t||(t={x:0,y:0,z:0}),i||(i=r()),this.addedObjects=[];var o=0;return n||(n=function(t){return t}),this.list.forEach(function(r){if(o++,"Q"==r.cmd){var s=0;r.path.forEach(function(r){r=n(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var a=i.projectVector(o);t.x+=a.x,t.y+=a.y,t.z+=a.z,0==s&&(e+="Q "),e+=" "+t.x.toFixed(3)+", "+t.y.toFixed(3),s++})}if("M"==r.cmd&&r.path.forEach(function(r){r=n(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z,e+="M "+t.x.toFixed(3)+", "+t.y.toFixed(3)}),"L"==r.cmd&&r.path.forEach(function(r){r=n(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z,e+="L "+t.x.toFixed(3)+", "+t.y.toFixed(3)}),"C"==r.cmd){var s=0;r.path.forEach(function(r){r=n(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var a=i.projectVector(o);t.x+=a.x,t.y+=a.y,t.z+=a.z,0==s&&(e+="C "),e+=" "+t.x.toFixed(3)+", "+t.y.toFixed(3),s++})}}),e}}(this)},h=function(t,i,n,r,e,o,s,a){if(!(this instanceof h))return new h(t,i,n,r,e,o,s,a);var f=[t,i,n,r,e,o,s,a];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=h._classInfo.name)return new c(t,i,n,r,e,o,s,a)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};h._classInfo={name:"pathIterator"},h.prototype=new s,"undefined"!=typeof window&&(window.pathIterator=h),"undefined"!=typeof window&&(window.pathIterator_prototype=s),function(t){var n;t.drawPath=function(t){var i,n;t.beginPath(),this._all.forEach(function(r){if("M"==r.name&&(i=r.points[0],n=r.points[1],t.moveTo(i,n)),"m"==r.name&&(i+=r.points[0],n+=r.points[1],t.moveTo(i,n)),"q"==r.name)for(var e=0;e<r.points.length;e+=4){var o=r.points,s=i+o[e+0],a=n+o[e+1],h=i+o[e+2],f=n+o[e+3];i=h,n=f,t.quadraticCurveTo(s,a,h,f,l,u)}if("Q"==r.name)for(var o=r.points,c=r.points.length,e=0;c>e;e+=4)t.quadraticCurveTo(o[e+0],o[e+1],o[e+2],o[e+3]);if("c"==r.name)for(var e=0;e<r.points.length;e+=6){var o=r.points,s=i+o[e+0],a=n+o[e+1],h=i+o[e+2],f=n+o[e+3],l=i+o[e+4],u=n+o[e+5];i=l,n=u,t.bezierCurveTo(s,a,h,f,l,u)}if("C"==r.name)for(var o=r.points,c=r.points.length,e=0;c>e;e+=6)t.bezierCurveTo(o[e+0],o[e+1],o[e+2],o[e+3],o[e+4],o[e+5]);if("l"==r.name)for(var e=0;e<r.points.length;e+=2){var o=r.points,s=i+o[e+0],a=n+o[e+1];i=s,n=a,t.lineTo(s,a)}if("H"==r.name)for(var e=0;e<r.points.length;e++){var o=r.points,s=o[e+0];i=s,t.lineTo(s,n)}if("V"==r.name)for(var e=0;e<r.points.length;e++){var o=r.points,a=o[e+0];n=a,t.lineTo(i,a)}if("L"==r.name)for(var e=0;e<r.points.length;e+=2){var o=r.points,s=o[e+0],a=o[e+1];i=s,n=a,t.lineTo(s,a)}"z"==r.name&&t.closePath()})},t.findDimensions=function(){if(this._limits)return this._limits;var t,i,n,r,e,o,s=function(e,o){"undefined"==typeof t&&(t=e,n=e,i=o,r=o),t=Math.min(t,e),i=Math.min(i,o),n=Math.max(n,e),r=Math.max(r,o)};return this._all.forEach(function(t){if("M"==t.name&&(e=t.points[0],o=t.points[1],s(e,o)),"m"==t.name&&(e+=t.points[0],o+=t.points[1],s(e,o)),"c"==t.name)for(var i=0;i<t.points.length;i+=6){var n=t.points,r=e+n[i+0],a=o+n[i+1],h=e+n[i+2],f=o+n[i+3],c=e+n[i+4],l=o+n[i+5];s(r,a),s(h,f),s(c,l),e=c,o=l}if("C"==t.name)for(var n=t.points,u=t.points.length,i=0;u>i;i+=6)s(n[i+0],n[i+1]),s(n[i+2],n[i+3]),s(n[i+4],n[i+5]);if("l"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points,r=e+n[i+0],a=o+n[i+1];e=r,o=a,s(e,o)}if("L"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points,r=n[i+0],a=n[i+1];e=r,o=a,s(e,o)}}),this._limits=[t,i,n,r],this._limits},t.fitPathInto=function(t,i){for(var n=this.findDimensions(),r=!0,e=0;4>e;e++)(n[e]<0||n[e]>t)&&(r=!1);var o=Math.abs(n[2]-n[0]),s=Math.abs(n[3]-n[1]),a=!1;Math.abs(n[3])<Math.abs(n[1])&&(a=!0);var h=t/o,f=i/s,c=-n[0],l=-n[1],u=Math.min(h,f),y=u;a&&(y=-y,l=-n[3]);var p=function(t){return(t+c)*u},x=function(t){return(t+l)*y};this._all.forEach(function(t){if("M"==t.name&&(t.points[0]=p(t.points[0]),t.points[1]=x(t.points[1])),"m"==t.name&&(t.points[0]*=u,t.points[1]*=y),"L"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points;n[i+0]=p(n[i+0]),n[i+1]=x(n[i+1])}if("c"==t.name)for(var i=0;i<t.points.length;i+=6){var n=t.points;n[i+0]*=u,n[i+2]*=u,n[i+4]*=u,n[i+1]*=y,n[i+3]*=y,n[i+5]*=y}if("C"==t.name)for(var n=t.points,r=t.points.length,i=0;r>i;i+=6)n[i+0]=p(n[i+0]),n[i+2]=p(n[i+2]),n[i+4]=p(n[i+4]),n[i+1]=x(n[i+1]),n[i+3]=x(n[i+3]),n[i+5]=x(n[i+5]);if("Q"==t.name)for(var n=t.points,r=t.points.length,i=0;r>i;i+=4)n[i+0]=p(n[i+0]),n[i+2]=p(n[i+2]),n[i+1]=x(n[i+1]),n[i+3]=x(n[i+3]);if("l"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points;n[i+0]*=u,n[i+1]*=y}}),this._limits=null},t.forCmds=function(t){this._all.forEach(t)},t.fromBezierArray=function(t){{var i,n=t.length;this._all}this._all=[];for(var i=0;n>i;i++){var r=t[i];if(0==i){var e={name:"M",points:[r.point_x(0),r.point_y(0)]};this._all.push(e)}var e={name:"C",points:[r.point_x(1),r.point_y(1),r.point_x(2),r.point_y(2),r.point_x(3),r.point_y(3)]};this._all.push(e)}this.saveToOriginals()},t.getCommands=function(){return this._all},t.getPath=function(t){return this._all[t]},t.getSegmentCount=function(){var t=this._all.length;return"z"==this._all[t-1].name&&t--,t},t.getSubPaths=function(){return this._subPaths},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,n||(n={})}),t.initCmd=function(t){return this._activeCmd={name:t,points:[]},this._all.push(this._activeCmd),this._activeCmd},t.inverse=function(){var t,i=this.originals(),n=i.length;this._all.reverse();var i=(this._all,this._all),r=[],e=function(t,i){for(var n=[],r=t.points.length/2,e=t.points.length-4;r>0;){if(1==r){if(!i)return n;e=i.points.length-2,n.push(i.points[e]),n.push(i.points[e+1])}else n.push(t.points[e]),n.push(t.points[e+1]),e-=2;r--}return n};"z"==i[0].name&&i.shift();for(var t=0;n>t;t++){{var o,s=i[t];i[t],i[t+1]}if(!s)break;if(t>0&&(o=i[t-1]),0==t){var a=s.points.length-2,h={name:"M",points:[s.points[a],s.points[a+1]]};r.push(h)}else{var h={name:o.name,points:e(o,s)};r.push(h)}}var h={name:"z",points:[]};r.push(h),this._all=r},t.makePathAbsolute=function(){var t,i,n,r,e=!0,o=function(){e&&(n=t,r=i);var o=t-n,s=i-r;return{x:t+o,y:i+s}};this._all.forEach(function(s){if("M"==s.name&&(t=s.points[0],i=s.points[1],e=!0),"L"==s.name&&(t=s.points[0],i=s.points[1],e=!0),"m"==s.name&&(t+=s.points[0],i+=s.points[1],s.points[0]=t,s.points[1]=i,s.name="M",e=!0),"q"==s.name){for(var a=0;a<s.points.length;a+=4){var h=s.points;h[a+0]=t+h[a+0],h[a+1]=i+h[a+1],h[a+2]=t+h[a+2],h[a+3]=i+h[a+3],t=h[a+2],i=h[a+3],s.name="Q"}e=!0}if("C"==s.name){var h=s.points;n=h[2],r=h[3],t=h[4],i=h[5],e=!1}if("c"==s.name){for(var a=0;a<s.points.length;a+=6){var h=s.points;h[a+0]=t+h[a+0],h[a+1]=i+h[a+1],h[a+2]=t+h[a+2],h[a+3]=i+h[a+3],h[a+4]=t+h[a+4],h[a+5]=i+h[a+5],t=h[a+4],i=h[a+5],n=h[a+2],r=h[a+3],s.name="C"}e=!1}if("S"==s.name){var h=s.points,f=o(),c=[];c[0]=f.x,c[1]=f.y,c[2]=h[0],c[3]=h[1],c[4]=h[2],c[5]=h[3],t=c[4],i=c[5],n=c[2],r=c[3],s.name="C",s.points=c,e=!1}if("s"==s.name){var h=s.points,f=o(),c=[];c[0]=f.x,c[1]=f.y,c[2]=t+h[0],c[3]=i+h[1],c[4]=t+h[2],c[5]=i+h[3],t=c[4],i=c[5],n=c[2],r=c[3],s.name="C",s.points=c,e=!1}if("h"==s.name){e=!0;for(var a=0;a<s.points.length;a++){var h=s.points,l=t+h[a+0];return t=l,h[a+0]=l,s.points=[l,i],void(s.name="L")}}if("H"==s.name){e=!0;for(var a=0;a<s.points.length;a++){var h=s.points,l=h[a+0];return t=l,h[a+0]=l,s.points=[l,i],void(s.name="L")}}if("V"==s.name){e=!0;for(var a=0;a<s.points.length;a++){var h=s.points,u=h[a+0];return i=u,s.points=[t,u],void(s.name="L")}}if("v"==s.name){e=!0;for(var a=0;a<s.points.length;a++){var h=s.points,u=i+h[a+0];return i=u,s.points=[t,u],void(s.name="L")}}if("l"==s.name){e=!0;for(var a=0;a<s.points.length;a+=2){var h=s.points,l=t+h[a+0],u=i+h[a+1];t=l,i=u,h[a+0]=l,h[a+1]=u,s.name="L"}}})},t.normalize=function(t,i){t||(t=800),i||(i=800),this.makePathAbsolute(),this.fitPathInto(t,i)},t.originals=function(){return this._original||(this._original=JSON.parse(JSON.stringify(this._all))),this._original},t.parse=function(t){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,this._usedCommands={},t||(t="M25.979,12.896 L 5.979,12.896,5.979,19.562,25.979,19.562z");var i=t,n=0,r=1e4;for(this._subPaths=t.split("M"),this._subIndex=0;(i=this.popCommand(i))&&0!=i.length&&i.length!=n&&!(r--<0);)n=i.length;return this._all},t.path=function(){return this._all},t.pathFunction=function(){},t.popCommand=function(t){t=t.trim();var i=t.charAt(0),n=null;if("M"==i&&(n=this.initCmd(i),t=t.substring(1)),"m"==i&&(n=this.initCmd(i),t=t.substring(1)),"Q"==i&&(n=this.initCmd(i),t=t.substring(1)),"q"==i&&(n=this.initCmd(i),t=t.substring(1)),"S"==i&&(n=this.initCmd(i),t=t.substring(1)),"s"==i&&(n=this.initCmd(i),t=t.substring(1)),"C"==i&&(n=this.initCmd(i),t=t.substring(1)),"c"==i&&(n=this.initCmd(i),t=t.substring(1)),"H"==i&&(n=this.initCmd(i),t=t.substring(1)),"h"==i&&(n=this.initCmd(i),t=t.substring(1)),"V"==i&&(n=this.initCmd(i),t=t.substring(1)),"v"==i&&(n=this.initCmd(i),t=t.substring(1)),"L"==i&&(n=this.initCmd(i),t=t.substring(1)),"l"==i&&(n=this.initCmd(i),t=t.substring(1)),"Z"==i&&(n=this.initCmd(i),t=t.substring(1)),"z"==i&&(n=this.initCmd(i),t=t.substring(1)),n){this._usedCommands[i]="true",t=t.trim();for(var r=!0;r&&t.length>0;){var e=t.charAt(0);","==e&&(t=t.substring(1),t=t.trim());for(var o=["-","1","2","3","4","5","6","7","8","9","0","."],s="",a=0;o.indexOf(t.charAt(0))>=0&&!("-"==t.charAt(0)&&(a++,a>1));)s+=t.charAt(0),t=t.substring(1),a=1;if(!(s.length>0))break;n.points.push(parseFloat(s)),t=t.trim()}}return n||(console.error("No command found for"),console.error(t)),this._activeCmd=n,this._stringLeft=t,t},t.relativePosition=function(t){var i=this.toBezierArray(),n=i.length,r=n*t,e=Math.floor(r);e>=n&&(e=n-1),0>e&&(e=0);var o=i[e],s=1/n,a=e/n,h=t,f=h-a,c=f/s,l={x:0,y:0,normal:{x:0,y:0}};l.x=o.x(c),l.y=o.y(c);var u=o.tangent(c,!0);return l.normal.x=u.x,l.normal.y=u.y,l},t.replacePartWith=function(t,n,e){var o=function(t,n){var e=a();e.parse(t),e.makePathAbsolute();var o=e.toBezierArray();e.fromBezierArray(o),n&&e.inverse();var s=e.toQuaternionPath(),f=function(t,n){var e=h(s),o=e.endPoint(),a="M 0 0 "+e.toSvgPath(),f=t;if(0==n.x&&0==n.y)return"";var c=Math.sqrt(o.x*o.x+o.y*o.y),l=Math.sqrt(n.x*n.x+n.y*n.y),u=l/c;if(0==c)return a;var y=i(),p=y.angleBetween(o,n),a=e.toSvgPath(f,r().rotate(p),function(t){return t.d=t.d*u,t});return a};return f},s=this.getPath(t);s.replaceFunction=o(n,e)},t.saveToOriginals=function(){this._original=JSON.parse(JSON.stringify(this._all))},t.scaleFactor=function(t,i){var n=this.findDimensions(),r=Math.abs(n[2]-n[0]),e=Math.abs(n[3]-n[1]),o=t/r,s=i/e,a=Math.min(o,s);return a},t.svgString=function(){var t,i,n="";return this._all.forEach(function(r){if("M"==r.name&&(t=r.points[0],i=r.points[1],n+="M"+t+","+i+" "),"m"==r.name&&(t+=r.points[0],i+=r.points[1],n+="M"+t+","+i+" "),"q"==r.name){n+="Q";for(var e=0;e<r.points.length;e+=4){var o=r.points,s=t+o[e+0],a=i+o[e+1],h=t+o[e+2],f=i+o[e+3];t=h,i=f,n+=s+","+a+" "+h+","+f+" "}}if("Q"==r.name){var o=r.points,c=r.points.length;n+="Q";for(var e=0;c>e;e+=4){var s=o[e+0],a=o[e+1],h=o[e+2],f=o[e+3];t=h,i=f,n+=s+","+a+" "+h+","+f+" "}}if("c"==r.name){n+="C";for(var e=0;e<r.points.length;e+=6){var o=r.points,s=t+o[e+0],a=i+o[e+1],h=t+o[e+2],f=i+o[e+3],l=t+o[e+4],u=i+o[e+5];t=l,i=u,n+=s+","+a+" "+h+","+f+" "+l+","+u+" "}}if("C"==r.name){var o=r.points,c=r.points.length;if(r.replaceFunction){for(var y={x:t,y:i},e=0;c>e;e+=6)t=o[e+4],i=o[e+5];var p={x:t-y.x,y:i-y.y},x=r.replaceFunction(y,p);console.log("The inserted path ",x),n+=" "+x+" "}else{n+="C";for(var e=0;c>e;e+=6)n+=o[e+0]+","+o[e+1]+" "+o[e+2]+","+o[e+3]+" "+o[e+4]+","+o[e+5]+" ",t=o[e+4],i=o[e+5]}}if("l"==r.name){n+="L";for(var e=0;e<r.points.length;e+=2){var o=r.points,s=t+o[e+0],a=i+o[e+1];t=s,i=a,n+=s+","+a+" "}}if("H"==r.name){n+="L";for(var e=0;e<r.points.length;e++){var o=r.points,s=o[e+0];t=s,n+=s+","+i+" "}}if("V"==r.name){n+="L";for(var e=0;e<r.points.length;e++){var o=r.points,a=o[e+0];i=a,n+=t+","+a+" "}}if("L"==r.name)if(r.replaceFunction){for(var y={x:t,y:i},e=0;e<r.points.length;e+=2){var o=r.points,s=o[e+0],a=o[e+1];t=s,i=a}var p={x:t-y.x,y:i-y.y},x=r.replaceFunction(y,p);console.log("The inserted path ",x),n+=" "+x+" "}else{n+="L";for(var e=0;e<r.points.length;e+=2){var o=r.points,s=o[e+0],a=o[e+1];t=s,i=a,n+=s+","+a+" "}}"z"==r.name&&(n+="z")}),n},t.toBezierArray=function(){var t,i,n="",r=[];return this._all.forEach(function(e){if("M"==e.name&&(t=e.points[0],i=e.points[1]),"Q"==e.name)for(var s=e.points,a=e.points.length,h=0;a>h;h+=4){var f=s[h+0],c=s[h+1],l=s[h+2],u=s[h+3],y=new o;y.fromQuadCurve({x:t,y:i},{x:f,y:c},{x:l,y:u}),r.push(y),t=l,i=u}if("C"==e.name)for(var s=e.points,a=e.points.length,h=0;a>h;h+=6){var f=s[h+0],c=s[h+1],l=s[h+2],u=s[h+3],p=s[h+4],x=s[h+5],y=new o;y.fromPoints({x:t,y:i},{x:f,y:c},{x:l,y:u},{x:p,y:x}),r.push(y),t=p,i=x}if("L"==e.name){n+="L";for(var h=0;h<e.points.length;h+=2){var s=e.points,f=s[h+0],c=s[h+1],y=new o;y.fromLine({x:t,y:i},{x:f,y:c}),r.push(y),t=f,i=c}}}),r},t.toQuaternionPath=function(){var t=!0,n={x:0,y:0},e={x:100,y:0},o={x:100,y:0},s=i(),a=[];return this.forCmds(function(i){var h={cmd:i.name,path:[]},f=function(i,a){e.x=i-n.x,e.y=a-n.y;var f=Math.sqrt(e.x*e.x+e.y*e.y);0==f&&(e.x+=.2,e.y+=.2,i+=.02,a+=.02,f=Math.sqrt(e.x*e.x+e.y*e.y));var c=s.angleBetween(o,e),l=r();l.setFromAxisRotation({x:0,y:0,z:1},c),t||h.path.push({q:l,d:f}),t=!1,n.x=i,n.y=a,o.x=e.x,o.y=e.y};"M"==i.name&&f(i.points[0],i.points[1]),"L"==i.name&&f(i.points[0],i.points[1]),"Q"==i.name&&(f(i.points[0],i.points[1]),f(i.points[2],i.points[3])),"C"==i.name&&(f(i.points[0],i.points[1]),f(i.points[2],i.points[3]),f(i.points[4],i.points[5])),h.path.length&&a.push(h)}),a},t.transformPoints=function(t){for(var i,n=this.originals(),r={x:0,y:0},e=n.length,i=(this._all,0);e>i;i++){var o=n[i],s=this._all[i];if(!o)return;if("M"==o.name&&(r.x=o.points[0],r.y=o.points[1],t(r),s.points[0]=r.x,s.points[1]=r.y),"Q"==o.name)for(var a=o.points,h=s.points,f=o.points.length,c=0;f>c;c+=4)r.x=a[c+0],r.y=a[c+1],t(r),h[c+0]=r.x,h[c+1]=r.y,r.x=a[c+2],r.y=a[c+3],t(r),h[c+2]=r.x,h[c+3]=r.y;if("C"==o.name)for(var a=o.points,h=s.points,f=o.points.length,c=0;f>c;c+=6)r.x=a[c+0],r.y=a[c+1],t(r),h[c+0]=r.x,h[c+1]=r.y,r.x=a[c+2],r.y=a[c+3],t(r),h[c+2]=r.x,h[c+3]=r.y,r.x=a[c+4],r.y=a[c+5],t(r),h[c+4]=r.x,h[c+5]=r.y;if("L"==o.name)for(var c=0;c<o.points.length;c+=2){var a=o.points,h=s.points;r.x=a[c+0],r.y=a[c+1],t(r),h[c+0]=r.x,h[c+1]=r.y}}}}(this)},a=function(t,i,n,r,e,o,s,h){if(!(this instanceof a))return new a(t,i,n,r,e,o,s,h);var f=[t,i,n,r,e,o,s,h];if(this.__factoryClass){var c,l=this;if(this.__factoryClass.forEach(function(t){c=t.apply(l,f)}),"[object Function]"==Object.prototype.toString.call(c)){if(c._classInfo.name!=a._classInfo.name)return new c(t,i,n,r,e,o,s,h)}else if(c)return c}if(this.__traitInit){var l=this;this.__traitInit.forEach(function(t){t.apply(l,f)})}else"function"==typeof this.init&&this.init.apply(this,f)};a._classInfo={name:"svgPathParser"},a.prototype=new s,"undefined"!=typeof window&&(window.svgPathParser=a),"undefined"!=typeof window&&(window.svgPathParser_prototype=s),function(t){var i,n,e,o;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(n={},e={},o={},i=!0)}),t.promiseImage=function(t){var i=r();if(n[t])return i.resolve(n[t]),e[t]=!1,i;if(o[t]||(o[t]=[]),o[t].push(i),e[t])return i;e[t]=!0;var s=new Image;return s.addEventListener("load",function(){n[t]=s;for(var i;i=o[t].pop();)i.resolve(s);e[t]=!1}),s.src=t,i}}(this),function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)},t.isStream=function(t){return"undefined"!=typeof Bacon&&this.isObject(t)&&t instanceof Bacon.Observable?!0:!1},t.str=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments);var n=!1,r=this,e=[];return i.forEach(function(t){r.isStream(t)?(n=!0,e.push("")):e.push(t)}),n?Bacon.fromBinder(function(t){return i.forEach(function(i,n){r.isStream(i)&&i.onValue(function(i){e[n]=i,t(e.join(""))})}),o().add(function(){t(e.join(""))}),function(){}}):i.join("")}}(this),function(t){t.add=function(t,i){return i?(this.hasOwnProperty("_inserts")||(this._inserts={}),this._inserts[t]||(this._inserts[t]=[]),i.parent(this),void this._inserts[t].push(i)):void this.add("children",t)},t.addClipMask=function(t){this.hasOwnProperty("_clipMasks")||(this._clipMasks=[]),this._clipMasks.push(t)},t.autoRender=function(){if(!this._autoRender){var t=this;this._autoRender=!0,o().every(1/60,function(){t.isDirty()&&(t.reset(),t.exec(),t.isDirty(!1))})}},t.clear=function(){this._commands=[],this._inserts={}},t.createColorIndex=function(){return ocColorIndex()},t.createHandle=function(t){this._colorIndex||(this._colorIndex=this.createColorIndex());var i=this._colorIndex,n=function(t,n,r,e,o,s){var a=t.create("handleCtx");a.save(),a.beginPath(),s._x=n,s._y=r,s.ctx=a,s.color=o,s.position=a.create("position"),s.position.translate(n,r),a.insert("shape"),a.add("shape",e),a.fillStyle(o),a.fill(),a.restore(),a.stroke(),i.add(o,s)},r=_e();n(this,t.x||0,t.y||0,t.shape,t.color,t.obj);var e=this;if(r._handleData=t,t.obj.handleObj=r,r.moveToPoint=function(i){t.obj.position.replace("translate",i.x,i.y)},!this._dragSet&&this._canvas){var o=this._canvas;this._dragSet=!0;var s;o.draggable(function(t,n){if(s=i.find(e.getPixel(n.x,n.y))){var r=s.handleObj;s.ctx.replace("fillStyle","yellow"),r.trigger("startdrag",n)}},function(t,i){if(s){var n=s.handleObj;s.position.replace("translate",s._x+i.dx,s._y+i.dy),s.ctx.replace("fillStyle","yellow"),n.trigger("drag",i)}},function(t,i){if(s){var n=s.handleObj;s.ctx.replace("fillStyle",s.color),s._x=s._x+i.dx,s._y=s._y+i.dy,n.trigger("enddrag",i)}})}return r},t.exec=function(t){t||(t=this._ctx),t._ctx&&(t=t._ctx);var i=this;this._commands.forEach(function(n){var r=n[0],e=n[1];if("circle"==r){var o=e[0],s=e[1],a=e[2];return void t.arc(o,s,a,0,2*Math.PI,!1)}if("drawImage"==r){var h=e[0];return void(h===Object(h)?t[r].apply(t,e):i.promiseImage(h).then(function(i){e[0]=i,t[r].apply(t,e)}))}if("insert"==r)return void i.forInserts(e[0],function(i){i.exec(t)});if("clipMask"==r)return void i.forClipMasks(function(i){i.exec(t)});if("children"==r)return void i.forChildren(function(i){i.exec(t)});if("setProperty"==r){var f=e[0],c=e[1];t[f]=i.isFunction(c)?c(t):c}else t[r]&&t[r].apply(t,e)})},t.execFn=function(t,i){var n=i||this._transform;i||n.reset();var r=this;this._commands.forEach(function(i){var e=i[0],o=i[1];if("insert"==e)return void r.forInserts(o[0],function(i){i.execFn(t,n)});if("clipMask"==e)return void r.forClipMasks(function(i){i.execFn(t,n)});if("children"==e)return void r.forChildren(function(i){i.execFn(t,n)});if("setProperty"==e){var s=o[0],a=o[1];t(s,o,n),n[s]&&n[s].apply(n,[a])}else n[e]&&n[e].apply(n,o),t(e,o,n)})},t.forChildren=function(t){this.forInserts("children",t)},t.forClipMasks=function(t){this.forInserts("clipMask",t)},t.forInserts=function(t,i){this._inserts&&this._inserts[t]&&this._inserts[t].forEach(i)},t.getPixel=function(t,i){return this._ctx?(data=this._ctx.getImageData(t,i,1,1).data,data?{x:t,y:i,r:data[0],g:data[1],b:data[2],a:data[3]}:null):null},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._commands||(this._commands=[]),this._undoBuffer=[],this._ctx=t,this._transform=new i;var n=this,r=["rect","fillRect","strokeRect","clearRect","fill","stroke","beginPath","moveTo","closePath","lineTo","clip","quadraticCurveTo","bezierCurveTo","arc","arcTo","scale","rotate","translate","transform","setTransform","fillText","strokeText","createImageData","putImageData","drawImage","circle","save","restore","setTransform"],e=["createLinearGradient","createPattern","createRadialGradient","addColorStop","isPointInPath","measureText","getImageData","toDataURL"],s=["width","height","data"],a=["globalAlpha","fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","font","textAlign","textBaseline","lineCap","lineJoin","lineWidth","miterLimit"],h=(new Date).getTime();o().onFrame(function(){h=(new Date).getTime()}),n.insert=function(){var t=Array.prototype.slice.call(arguments);return n._commands.push(["insert",t,h]),this},n.create=function(){var t=Array.prototype.slice.call(arguments);n._commands.push(["insert",t,h]);var i=canvasContext();return n.add(t[0],i),i},n.clipMask=function(){n.insert("clipMask")},n.children=function(){return n.insert("children"),this},r.forEach(function(t){n[t]=function(){n._undoBuffer=[];var i=Array.prototype.slice.call(arguments);return i.forEach(function(t,r){n.isStream(t)&&(i[r]=null,t.onValue(function(t){i[r]=t}))}),n._commands.push([t,i,h]),this}}),e.forEach(function(i){n[i]=function(){var n=Array.prototype.slice.call(arguments);return t[i].apply(t,n)}}),s.forEach(function(t){n[t]=function(){return n._ctx[t]}}),a.forEach(function(t){n[t]=function(i){if("undefined"!=typeof i){var r=[t,i];if(console.log("Setting value to ",t),n.isStream(i)){var e=["waitValue",r,h];r[1]=null,i.onValue(function(t){e[0]="setProperty",r[1]=t}),n._commands.push(e)}else n._commands.push(["setProperty",r,h]);return n}return n._ctx[t]}})}),t.isDirty=function(t){if("undefined"!=typeof t){this._dirty=t;var i;return(i=this.parent())&&i.isDirty(!0),this}return this._dirty},t.n=function(t){return t.toFixed(5)},t.paintHead=function(){return ocPaintHead(this)},t.parent=function(t){return"undefined"!=typeof t?(this._parent=t,this):this._parent},t.redo=function(){if(this._commands){var t,i=this._undoBuffer.pop();if(i){for(t=i[2];i&&i[2]==t;)this._commands.push(i),i=this._undoBuffer.pop();i&&this._undoBuffer.push(i)}}},t.renderPath=function(t,i,n){var r=a();r.parse(t),r.makePathAbsolute(),r.fitPathInto(i,n),r.drawPath(this)},t.renderSvg=function(t){var i,n=[],r=null,e=null,o=!1,s=this,a="black";i=t?t.g():_e().g();return s.execFn(function(t,s,h){if("beginPath"==t&&(n=[],o=!1,a="none",r=i.path("",{d:"",stroke:h.getStyle("strokeStyle"),fill:h.getStyle("fillStyle"),"fill-opacity":h.getStyle("globalAlpha")})),"drawImage"==t&&(n=[],r=i.image("",{"xlink:href":s[0],x:s[1],y:s[2],width:s[3],height:s[4]})),"circle"==t&&(n=[],r=i.circle("",{cx:s[0],cy:s[1],r:s[2],transform:h.getSvgTransform(),stroke:h.getStyle("strokeStyle"),fill:h.getStyle("fillStyle")})),"rect"==t&&(n=[],r=i.rect("",{x:s[0],y:s[1],width:s[2],height:s[3],transform:h.getSvgTransform(),stroke:h.getStyle("strokeStyle"),fill:h.getStyle("fillStyle")})),"arc"==t){var f=h.transformPoint(s[0],s[1]),c=f.x,l=f.y,u=h.transformDelta(s[2],s[2]);l-=u.y,n.push("M "+c+" "+l),n.push("A "+u.x+","+u.y+" 0 1,0 "+(c+.1)+" "+l+" ")}if("fillText"==t){var y=s[0],f=h.transformPoint(s[1],s[2]),c=f.x,l=f.y,u=h.transformDelta(parseInt(h.getStyle("font-size")),parseInt(h.getStyle("font-size"))),p=u.x,x=h.getStyle("font-family");r=i.svg_text("",{x:s[1],y:s[2]}),r.text(y),r.q.attr("font-size",parseInt(h.getStyle("font-size"))),r.q.attr("font-family",x),r.q.attr("fill",h.getStyle("fillStyle")),r.q.attr("fill-opacity",h.getStyle("globalAlpha")),r.q.attr("transform",h.getSvgTransform()),o=!1,n=[],r=null}if("strokeText"==t){var y=s[0],f=h.transformPoint(s[1],s[2]),c=f.x,l=f.y,u=h.transformDelta(parseInt(h.getStyle("font-size")),parseInt(h.getStyle("font-size"))),p=u.x,x=h.getStyle("font-family");
r=i.svg_text("",{x:c,y:l}),r.text(y),r.q.attr("fill","none"),r.q.attr("font-size",p),r.q.attr("font-family",x),r.q.attr("stroke",h.getStyle("strokeStyle")),r.q.attr("stroke-opacity",h.getStyle("globalAlpha")),o=!1,n=[],r=null}if("quadraticCurveTo"==t){var _=h._point.tx0,m=h._point.ty0,f=h.transformPoint(s[0],s[1]),v=f.x,d=f.y,f=h.transformPoint(s[2],s[3]),g=f.x,I=f.y;0==n.length&&n.push("M "+_+" "+m),n.push("Q "+v+" "+d+" "+g+" "+I+" ")}if("bezierCurveTo"==t){var _=h._point.tx0,m=h._point.ty0,f=h.transformPoint(s[0],s[1]),v=f.x,d=f.y,f=h.transformPoint(s[2],s[3]),g=f.x,I=f.y,f=h.transformPoint(s[4],s[5]),w=f.x,P=f.y;0==n.length&&n.push("M "+_+" "+m),n.push("C "+v+" "+d+" "+g+" "+I+" "+w+" "+P+" ")}if("moveTo"==t){var C=h._point.tx1,j=h._point.ty1,_=h._point.tx0,m=h._point.ty0;n.push("M "+C+" "+j)}if("lineTo"==t){var C=h._point.tx1,j=h._point.ty1,_=h._point.tx0,m=h._point.ty0;console.log("lineTo",_,m,C,j),0==n.length&&n.push("M "+_+" "+m),n.push("L "+C+" "+j)}if("stroke"==t){r&&(e=r),r=null,a="black";var b=n.join(" ");console.log("path",b),n.length&&e.q.attr("d",b),console.log("new way"),e.attr({stroke:h.getStyle("strokeStyle"),"stroke-opacity":h.getStyle("globalAlpha"),"stroke-width":h.transformDelta(h.getStyle("lineWidth")>>0,h.getStyle("lineWidth")>>0).x||1}),o=!0}if("fill"==t){r&&(e=r),r=null,o||n.push("z");var b=n.join(" ");console.log("path",b),n.length&&e.q.attr("d",b),e.q.attr("stroke",h.getStyle("strokeStyle")),e.q.attr("fill",h.getStyle("fillStyle")),e.q.attr("fill-opacity",h.getStyle("globalAlpha")),o=!0}}),i},t.replace=function(t){var i=Array.prototype.slice.call(arguments);i.shift();var n=this;this._commands.forEach(function(r){var e=r[0];e==t&&(r[1]=i,n.isDirty(!0)),"setProperty"==e&&r[1][0]==t&&(r[1][1]=i[0],n.isDirty(!0))})},t.reset=function(){var t=this._ctx;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height)},t.serialize=function(){var t={};t.commands=this._commands,t.inserts={};var i=this._inserts;if(i)for(var n in i)if(i.hasOwnProperty(n)){var r=[];i[n].forEach(function(t){r.push(t.serialize())}),t.inserts[n]=r}return t},t.set=function(t,i){return i?(this.hasOwnProperty("_inserts")||(this._inserts={}),this._inserts[t]||(this._inserts[t]=[]),this._inserts[t].length=0,i.parent(this),void this._inserts[t].push(i)):void this.set("children",t)},t.shadow=function(t,i){this.shadowBlur(t),this.shadowOffsetX(0),this.shadowOffsetY(0),this.shadowColor(i||"#000000")},t.shapes=function(){return ocPathLib(this)},t.svgPathString=function(){var t=[],i=!1,n=this,r="",e="black",o=this;return n.execFn(function(n,s,a){if("beginPath"==n&&(t=[],i=!1,e="none"),"arc"==n){var h=a.transformPoint(s[0],s[1]),f=h.x,c=h.y,l=a.transformDelta(s[2],s[2]);c-=l.y,t.push("M "+o.n(f)+" "+o.n(c)),t.push("A "+o.n(l.x)+","+o.n(l.y)+" 0 1,0 "+o.n(f+.1)+" "+o.n(c)+" ")}if("quadraticCurveTo"==n){var u=a._point.tx0,y=a._point.ty0,h=a.transformPoint(s[0],s[1]),p=h.x,x=h.y,h=a.transformPoint(s[2],s[3]),_=h.x,m=h.y;0==t.length&&t.push("M "+o.n(u)+" "+o.n(y)),t.push("Q "+o.n(p)+" "+o.n(x)+" "+o.n(_)+" "+o.n(m)+" ")}if("bezierCurveTo"==n){var u=a._point.tx0,y=a._point.ty0,h=a.transformPoint(s[0],s[1]),p=h.x,x=h.y,h=a.transformPoint(s[2],s[3]),_=h.x,m=h.y,h=a.transformPoint(s[4],s[5]),v=h.x,d=h.y;0==t.length&&t.push("M "+o.n(u)+" "+o.n(y)),t.push("C "+o.n(p)+" "+o.n(x)+" "+o.n(_)+" "+o.n(m)+" "+o.n(v)+" "+o.n(d)+" ")}if("moveTo"==n){var g=a._point.tx1,I=a._point.ty1,u=a._point.tx0,y=a._point.ty0;t.push("M "+o.n(g)+" "+o.n(I))}if("lineTo"==n){var g=a._point.tx1,I=a._point.ty1,u=a._point.tx0,y=a._point.ty0;0==t.length&&t.push("M "+o.n(u)+" "+o.n(y)),t.push("L "+o.n(g)+" "+o.n(I))}"stroke"==n&&t.length>0&&(r||(r=t.join(" "))),"fill"==n&&t.length>0&&(r||(r=t.join(" ")))}),t.length>0&&(r||(r=t.join(" "))),r},t.undo=function(){if(this._commands){var t,i=this._commands.pop();if(i){for(t=i[2];i&&i[2]==t;)this._undoBuffer.push(i),i=this._commands.pop();i&&this._commands.push(i)}console.log(this._commands)}},t.unserialize=function(t){var i=canvasContext();i._commands=t.commands;var n=t.inserts;if(n){i._inserts={};for(var r in n)if(n.hasOwnProperty(r)){var e=[];n[r].forEach(function(t){e.push(canvasContext().unserialize(t))}),i._inserts[r]=e}}return i},t.waitValue=function(){}}(this)},canvasContext=function(t,i,n,r,e,o,s,a){if(!(this instanceof canvasContext))return new canvasContext(t,i,n,r,e,o,s,a);var h=[t,i,n,r,e,o,s,a];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,h)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=canvasContext._classInfo.name)return new f(t,i,n,r,e,o,s,a)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,h)})}else"function"==typeof this.init&&this.init.apply(this,h)};canvasContext._classInfo={name:"canvasContext"},canvasContext.prototype=new canvasContext_prototype,"undefined"!=typeof window&&(window.canvasContext=canvasContext),"undefined"!=typeof window&&(window.canvasContext_prototype=canvasContext_prototype);