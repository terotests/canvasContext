var canvasContext_prototype=function(){"use strict";var t=function(){!function(t){var i,n;t.arcTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.bezierCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.copyFrom=function(t){t.m&&(t=t.m);for(var i=this.m,n=!1,e=0;6>e;e++)i[e]!=t[e]&&(n=!0);return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],n},t.fillStyle=function(t){this.setStyle("fillStyle",t)},t.font=function(t){var i=t.split(" ");this.setStyle("font-size",i[0]),this.setStyle("font-family",i[1])},t.getStyle=function(t){var i=this._fillState[this._fillState.length-1];return i?i[t]:void 0},t.getSvgTransform=function(){var t=this.m;return"matrix("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+")"},t.globalAlpha=function(t){this.setStyle("globalAlpha",t)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(n={x:0,y:0}),this.reset(),this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0}}),t.invert=function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),i=this.m[3]*t,n=-this.m[1]*t,e=-this.m[2]*t,r=this.m[0]*t,s=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=i,this.m[1]=n,this.m[2]=e,this.m[3]=r,this.m[4]=s,this.m[5]=o},t.lineTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.lineWidth=function(t){this.setStyle("lineWidth",t)},t.moveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.multiply=function(t){var i=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],e=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],s=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=i,this.m[1]=n,this.m[2]=e,this.m[3]=r,this.m[4]=s,this.m[5]=o},t.quadraticCurveTo=function(){var t=Array.prototype.slice.call(arguments);this._point.tx0=this._point.tx1,this._point.ty0=this._point.ty1,this._point.y=t.pop(),this._point.x=t.pop();var i=this.transformPoint(this._point.x,this._point.y);this._point.tx1=i.x,this._point.ty1=i.y},t.reset=function(){if(this.m){var t=this.m;t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this._point.x=0,this._point.y=0,this._point.tx1=0,this._point.ty1=0,this._point.tx0=0,this._point.ty0=0}else this.m=[1,0,0,1,0,0],this._point={x:0,y:0,tx0:0,ty0:0,tx1:0,ty1:0};this._fillState=[{globalAlpha:1,fillStyle:"none",strokeStyle:"black","font-size":10,lineWidth:1,"font-family":"Arial"}]},t.restore=function(){this.m=this._oldies.pop(),this._fillState.pop()},t.rotate=function(t){var i=Math.cos(t),n=Math.sin(t),e=this.m[0]*i+this.m[2]*n,r=this.m[1]*i+this.m[3]*n,s=this.m[0]*-n+this.m[2]*i,o=this.m[1]*-n+this.m[3]*i;this.m[0]=e,this.m[1]=r,this.m[2]=s,this.m[3]=o},t.rotateAround=function(t,i,n){this.translate(t,i),this.rotate(n*Math.PI/180),this.translate(-t,-i)},t.save=function(){var t=this.m.slice(0);this._oldies||(this._oldies=[]),this._oldies.push(t);var i=this._fillState[this._fillState.length-1],n={};for(var e in i)i.hasOwnProperty(e)&&(n[e]=i[e]);this._fillState.push(n)},t.scale=function(t,i){isNaN(t)||isNaN(i)||(this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i)},t.setStyle=function(t,i){var n=this._fillState[this._fillState.length-1];n&&(n[t]=i)},t.strokeStyle=function(t){this.setStyle("strokeStyle",t)},t.transformDelta=function(t,i){return n.x=t*this.m[0]+i*this.m[2],n.y=t*this.m[1]+i*this.m[3],n},t.transformPoint=function(t,i){var e=t,r=i;return n.x=e*this.m[0]+r*this.m[2]+this.m[4],n.y=e*this.m[1]+r*this.m[3]+this.m[5],n},t.translate=function(t,i){this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i},t.translateAbsolute=function(t,i){this.m[4]=this.m[0]*t+this.m[2]*i,this.m[5]=this.m[1]*t+this.m[3]*i},t.updateContext=function(t){var i=this.m;t.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},t.xScaleFactor=function(){var t=this.m[0],i=this.m[2];return Math.sqrt(t*t+i*i)}}(this)},i=function(t,n,e,r,s,o,a,h){if(!(this instanceof i))return new i(t,n,e,r,s,o,a,h);var l=[t,n,e,r,s,o,a,h];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=i._classInfo.name)return new f(t,n,e,r,s,o,a,h)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,l)})}else"function"==typeof this.init&&this.init.apply(this,l)};i._classInfo={name:"ocTransform"},i.prototype=new t;var n=function(){var t=function(){!function(t){var i,n,e,r,s;t.add=function(t,i,e){if(i||e){var r;"[object Array]"===Object.prototype.toString.call(e)?r=e:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),n.push([i,t,r])}else n.push(t)},t.after=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),r[n]={step:Math.floor(1e3*t),fn:i,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),r[n]={step:Math.floor(1e3*t),fn:i,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!i){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(i){t||(t=window[i+"RequestAnimationFrame"],o=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),n=[],e={},r={},s=[];var a=0,h=function(){for(var i,o=(new Date).getTime();i=n.shift();)"[object Array]"===Object.prototype.toString.call(i)?i[1].apply(i[0],i[2]):i();for(var l=0;l<s.length;l++){var f=s[l];f()}for(var c in e)if(e.hasOwnProperty(c)){var u=e[c];u[0](u[1]),delete e[c]}for(var c in r)if(r.hasOwnProperty(c)){var u=r[c];u.nextTime<o&&(u.remove?u.nextTime>0?(u.fn(),delete r[c]):u.nextTime=o+u.step:(u.fn(),u.nextTime=o+u.step)),u.until&&u.until<o&&delete r[c]}t(h),a=o};h(),i=!0}}),t.once=function(t,i,n){e[t]=[i,n]},t.onFrame=function(t){s.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var i=s.indexOf(t);return i>=0?(t._onRemove&&t._onRemove(),s.splice(i,1),!0):!1}}(this)},i=function(t,n,e,r,s,o,a,h){if(!(this instanceof i))return new i(t,n,e,r,s,o,a,h);var l=[t,n,e,r,s,o,a,h];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=i._classInfo.name)return new f(t,n,e,r,s,o,a,h)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,l)})}else"function"==typeof this.init&&this.init.apply(this,l)};i._classInfo={name:"later"},i.prototype=new t,"undefined"!=typeof window&&(window.later=i),"undefined"!=typeof window&&(window.later_prototype=t),function(t){t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.all=function(t){var i;i=this.isArray(t)?t:Array.prototype.slice.call(arguments,0);var n=i.length,r=0,s=[],o=new Array(n);return this.then(function(){var t=e();return 0==i.length&&t.resolve([]),i.forEach(function(i,e){i.then?(s.push(i),i.then(function(i){o[e]=i,r++,r==n&&t.resolve(o)},function(i){t.reject(i)})):t.reject("Not list of promises")}),t})},t.collect=function(t,i,n){var r;r=this.isArray(i)?i:[i];var s=r.length,o=!1,a=!1,h=0,l=[],f=n||{};return this.then(function(){var i=e();return r.forEach(function(n){n.then?(l.push(n),n.then(function(n){h++,o=t(n,f),(o&&!a||0==a&&s==h)&&(i.resolve(f),a=!0)},function(t){i.reject(t)})):i.reject("Not list of promises")}),i})},t.fail=function(t){return this.then(null,t)},t.fulfill=function(t){if(!(this._rejected||this._fulfilled&&t!=this._stateValue)){this._fulfilled=!0,this._stateValue=t;for(var i=this._childPromises.length;i--;){var n=this._childPromises.shift();if(n._onFulfill)try{var e=n._onFulfill(t);"undefined"!=typeof e?n.resolve(e):n.fulfill(t)}catch(r){n.reject(r)}else n.fulfill(t)}this._state=1,this.triggerStateChange()}},t.genPlugin=function(t,i){this.plugin(t,function(){var t=Array.prototype.slice.call(arguments,0);console.log("Plugin args",t);var n=e();return this.then(function(){var e=Array.prototype.slice.call(arguments,0),r=t.concat(e),s=i.apply(this,r);n.resolve(s)},function(t){n.reject(t)}),n})},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n){if(this._state=0,this._stateValue=null,this._isAPromise=!0,this._childPromises=[],this.isFunction(t)&&(this._onFulfill=t),this.isFunction(n)&&(this._onReject=n),!n&&this.isFunction(t)){var e=this;i().asap(function(){console.log("--- calling the onFulfilled "),t(function(t){e.resolve(t)},function(t){e.resolve(t)})})}}),t.isFulfilled=function(){return 1==this._state},t.isPending=function(){return 0==this._state},t.isRejected=function(){return 2==this._state},t.nodeStyle=function(t,i){this.plugin(t,function(){var t,n,e=Array.prototype.slice.call(arguments,0),r=0;e.length>=0&&(t=e[e.length-1],"[object Function]"==Object.prototype.toString.call(t)&&(n=t,r=e.length-1));var s=wishes().pending();return this.then(function(){var t=wishes().pending(),o=Array.prototype.slice.call(arguments,0);console.log("Orig args",e),console.log("Then args",o);var a;0==e.length&&(a=o),0==o.length&&(a=e),a||(a=o.concat(e)),r=a.length,n&&r--,a[r]=function(i){if(i)return console.log("Got error ",i),t.reject(i),void s.reject(i);if(n){var e=Array.prototype.slice.call(arguments),r=n.apply(this,e);s.resolve(r)}else{var e=Array.prototype.slice.call(arguments,1);s.resolve.apply(s,e)}},t.then(function(t){s.resolve(t)}),console.log("nodeStyle after concat",a);i.apply(this,a);return t},function(t){s.reject(t)}),s})},t.onStateChange=function(t){this._listeners||(this._listeners=[]),this._listeners.push(t)},t.plugin=function(i,n){return t[i]=n,this},t.props=function(t){var i=[];for(var n in t)t.hasOwnProperty(n)&&i.push({name:n,promise:t[n]});var e=i.length,r=0,s=[],o={};return this.then(function(){var t=wishes().pending();return i.forEach(function(i){var n=i.promise,a=i.name;n.then?(s.push(n),n.then(function(i){o[a]=i,r++,r==e&&t.resolve(o)},function(i){t.reject(i)})):t.reject("Not list of promises")}),t})},t.reject=function(t){if(!(this._fulfilled||this._rejected&&t!=this._rejectReason)){this._state=2,this._rejected=!0,this._rejectReason=t;for(var i=this._childPromises.length;i--;){var n=this._childPromises.shift();if(n._onReject)try{n._onReject(t),n.reject(t)}catch(e){n.reject(e)}else n.reject(t)}this.triggerStateChange()}},t.rejectReason=function(t){return t?void(this._rejectReason=t):this._rejectReason},t.resolve=function(t){if(!(this._state>0)){if(t==this)return this._rejectReason="TypeError",void this.reject(this._rejectReason);if(this.isObject(t)&&t._isAPromise){if(this._state=t._state,this._stateValue=t._stateValue,this._rejectReason=t._rejectReason,0===this._state){var i=this;t.onStateChange(function(){1==t._state&&i.resolve(t.value()),2==t._state&&i.reject(t.rejectReason())})}return 1==this._state&&this.fulfill(this._stateValue),void(2==this._state&&this.reject(this._rejectReason))}if(this.isObject(t)&&t.then&&this.isFunction(t.then)){var n=!1;try{var i=this;t.then.call(t,function(t){n||(i.resolve(t),n=!0)},function(t){n||(i.reject(t),n=!0)})}catch(e){n||this.reject(e)}}else this._state=1,this._stateValue=t,this.fulfill(t)}},t.state=function(t){return"undefined"!=typeof t&&(this._state=t),this._state},t.then=function(t,n){n||(n=function(){});var r=new e(t,n),s=this;return 1==this._state&&i().asap(function(){s.fulfill(s.value())}),2==this._state&&ater().asap(function(){s.reject(s.rejectReason())}),this._childPromises.push(r),r},t.triggerStateChange=function(){var t=this;this._listeners&&(this._listeners.forEach(function(i){i(t)}),this._listeners.length=0)},t.value=function(t){return"undefined"!=typeof t?(this._stateValue=t,this):this._stateValue}}(this)},e=function(t,i,n,r,s,o,a,h){if(!(this instanceof e))return new e(t,i,n,r,s,o,a,h);var l=[t,i,n,r,s,o,a,h];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=e._classInfo.name)return new f(t,i,n,r,s,o,a,h)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,l)})}else"function"==typeof this.init&&this.init.apply(this,l)};e._classInfo={name:"_promise"},e.prototype=new n,"undefined"!=typeof window&&(window._promise=e),"undefined"!=typeof window&&(window._promise_prototype=n);var r=function(){!function(t){var i,n,e,r,s;t.add=function(t,i,e){if(i||e){var r;"[object Array]"===Object.prototype.toString.call(e)?r=e:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),n.push([i,t,r])}else n.push(t)},t.after=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),r[n]={step:Math.floor(1e3*t),fn:i,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,i,n){n||(n="time"+(new Date).getTime()+Math.random(1e7)),r[n]={step:Math.floor(1e3*t),fn:i,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!i){this.polyfill();var t,o;if("undefined"!=typeof window){var t=window.requestAnimationFrame,o=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(i){t||(t=window[i+"RequestAnimationFrame"],o=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),o||(o=function(t){clearTimeout(t)}),n=[],e={},r={},s=[];var a=0,h=function(){for(var i,o=(new Date).getTime();i=n.shift();)"[object Array]"===Object.prototype.toString.call(i)?i[1].apply(i[0],i[2]):i();for(var l=0;l<s.length;l++){var f=s[l];f()}for(var c in e)if(e.hasOwnProperty(c)){var u=e[c];u[0](u[1]),delete e[c]}for(var c in r)if(r.hasOwnProperty(c)){var u=r[c];u.nextTime<o&&(u.remove?u.nextTime>0?(u.fn(),delete r[c]):u.nextTime=o+u.step:(u.fn(),u.nextTime=o+u.step)),u.until&&u.until<o&&delete r[c]}t(h),a=o};h(),i=!0}}),t.once=function(t,i,n){e[t]=[i,n]},t.onFrame=function(t){s.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var i=s.indexOf(t);return i>=0?(t._onRemove&&t._onRemove(),s.splice(i,1),!0):!1}}(this)},s=function(t,i,n,e,r,o,a,h){if(!(this instanceof s))return new s(t,i,n,e,r,o,a,h);var l=[t,i,n,e,r,o,a,h];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=s._classInfo.name)return new f(t,i,n,e,r,o,a,h)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,l)})}else"function"==typeof this.init&&this.init.apply(this,l)};s._classInfo={name:"later"},s.prototype=new r,"undefined"!=typeof window&&(window.later=s),"undefined"!=typeof window&&(window.later_prototype=r);var o=function(){var t=function(){!function(t){var i,n,e,r,s,o,a,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var n=this.normalize({x:t.x,y:t.y}),e=this.normalize({x:i.x,y:i.y}),r=this.crossProd(n,e),s=this.dotProd(n,e),o=Math.acos(s);return 0>r&&(o=-1*o),o},t.calc_cat=function(t,i,n,e,r){var s=t*t,o=s*t;return.5*(2*n+(-i+e)*t+(2*i-5*n+4*e-r)*s+(-i+3*n-3*e+r)*o)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var n=t.x-i.x,e=t.y-i.y;return Math.sqrt(n*n+e*e)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,n){var e=a;return e.A=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),e.sign=e.A<0?-1:1,e.s1=(t.y*n.x-t.x*n.y+(n.y-t.y))*e.sign,e.s2=(n.y-t.y)*e.sign,e.s3=(t.x-n.x)*e.sign,e.t1=(t.x*i.y-t.y*i.x)*e.sign,e.t2=(t.y-i.y)*e.sign,e.t3=(i.x-t.x)*e.sign,e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){s||(s={x:0,y:0},o={x:0,y:0},i=[0,0,0,0],n={x:0,y:0},e={x:0,y:0},r={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){e.y=i.y-t.y,e.x=i.x-t.x,n.y=e.y,n.x=e.x,this.normalize(e),this.normalize(n),this.rotate(n,Math.PI/2),r.x=t.x,r.y=t.y},t.length=function(t){var i=t.x,n=t.y;return Math.sqrt(i*i+n*n)},t.linesIntersect=function(t,i,n,e){var r=t.x,s=t.y,o=i.x,a=i.y,h=n.x,l=n.y,f=e.x,c=e.y,u=((r*a-s*o)*(h-f)-(r-o)*(h*c-l*f))/((r-o)*(l-c)-(s-a)*(h-f)),p=((r*a-s*o)*(l-c)-(s-a)*(h*c-l*f))/((r-o)*(l-c)-(s-a)*(h-f));if(isNaN(u)||isNaN(p))return!1;if(r>=o){if(!(u>=o&&r>=u))return!1}else if(!(u>=r&&o>=u))return!1;if(s>=a){if(!(p>=a&&s>=p))return!1}else if(!(p>=s&&a>=p))return!1;if(h>=f){if(!(u>=f&&h>=u))return!1}else if(!(u>=h&&f>=u))return!1;if(l>=c){if(!(p>=c&&l>=p))return!1}else if(!(p>=l&&c>=p))return!1;return!0},t.mirrorVector=function(t,i,n){s.x=i.x-n.x,s.y=i.y-n.y,o.x=-s.y,o.y=s.x,t.x=t.x-n.x,t.y=t.y-n.y,this.dotProd(t,o)>0&&this.rotate(o,Math.PI),this.normalize(s),this.normalize(o);var e=Math.abs(this.dotProd(t,o)),r=this.dotProd(t,s);return t.x=o.x*e+s.x*r,t.y=o.y*e+s.y*r,t.x+=n.x,t.y+=n.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){s.x=i,x,s.y=i.y,o.x=-s.y,o.y=s.x,this.normalize(s),this.normalize(o),this.rotate(s,Math.PI);var n=Math.abs(jsMath.dotProd(t,o)),e=Math.abs(jsMath.dotProd(t,s));return this.dotProd(t,o)<0&&this.rotate(o,Math.PI),t.x=o.x*n+s.x*e,t.y=o.y*n+s.y*e,t},t.pointInTriangle=function(t,i,n,e){var r=.5*(-n.y*e.x+i.y*(-n.x+e.x)+i.x*(n.y-e.y)+n.x*e.y),s=0>r?-1:1,o=(i.y*e.x-i.x*e.y+(e.y-i.y)*t.x+(i.x-e.x)*t.y)*s,a=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*s;return o>0&&a>0&&2*r*s>o+a},t.pointInTriangleBc=function(t,i){var n=i.A,e=i.sign,r=i.s1+i.s2*t.x+i.s3*t.y,s=i.t1+i.t2*t.x+i.t3*t.y;return r>0&&s>0&&2*n*e>r+s},t.project=function(t){var i=t;return pVector.x=i.x-r.x,pVector.y=i.y-r.y,prodResult.i=this.dotProd(pVector,e),prodResult.j=this.dotProd(pVector,n),prodResult},t.rotate=function(t,i){var n=Math.sin(i),e=Math.cos(i),r=t.x,s=t.y;return t.x=r*e+s*n,t.y=-r*n+s*e,t},t.rotateAround=function(t,i,n){this.sub(i,n),this.rotate(i,t),this.add(i,n)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,n){var e={};e.x=i.x-t.x,e.y=i.y-t.y;var r={};r.x=n.x-i.x,r.y=n.y-i.y;var s={x:e.x+r.x,y:e.y+r.y};return this.normalize(s)},t.triangleArea=function(t,i,n){var e=t.x*(i.y-n.y)+i.x*(n.y-t.y)+n.x*(t.y-i.y);return Math.abs(e/2)},t.triangleInTriangle=function(t,i,n,e,r,s){var o=this.getBarCoeffs(t,i,n);if(this.pointInTriangleBc(e,o))return!0;if(this.pointInTriangleBc(r,o))return!0;if(this.pointInTriangleBc(s,o))return!0;var o=this.getBarCoeffs(e,r,s);return this.pointInTriangleBc(t,o)?!0:this.pointInTriangleBc(i,o)?!0:this.pointInTriangleBc(n,o)?!0:this.linesIntersect(t,i,e,r)?!0:this.linesIntersect(i,n,e,r)?!0:this.linesIntersect(n,t,e,r)?!0:this.linesIntersect(t,i,r,s)?!0:this.linesIntersect(i,n,r,s)?!0:this.linesIntersect(n,t,r,s)?!0:this.linesIntersect(t,i,s,e)?!0:this.linesIntersect(i,n,s,e)?!0:this.linesIntersect(n,t,s,e)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*e.x+i.j*n.x,h.y=i.i*e.y+i.j*n.y,h.x+=r.x,h.y+=r.y,h}}(this)},i=function(t,n,e,r,s,o,a,h){if(!(this instanceof i))return new i(t,n,e,r,s,o,a,h);var l=[t,n,e,r,s,o,a,h];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=i._classInfo.name)return new f(t,n,e,r,s,o,a,h)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,l)})}else"function"==typeof this.init&&this.init.apply(this,l)};i._classInfo={name:"jsVectors"},i.prototype=new t,"undefined"!=typeof window&&(window.jsVectors=i),"undefined"!=typeof window&&(window.jsVectors_prototype=t),function(t){var n;t.drawPath=function(t){var i,n;t.beginPath(),this._all.forEach(function(e){if("M"==e.name&&(i=e.points[0],n=e.points[1],t.moveTo(i,n)),"m"==e.name&&(i+=e.points[0],n+=e.points[1],t.moveTo(i,n)),"q"==e.name)for(var r=0;r<e.points.length;r+=4){var s=e.points,o=i+s[r+0],a=n+s[r+1],h=i+s[r+2],l=n+s[r+3];i=h,n=l,t.quadraticCurveTo(o,a,h,l,c,u)}if("Q"==e.name)for(var s=e.points,f=e.points.length,r=0;f>r;r+=4)t.quadraticCurveTo(s[r+0],s[r+1],s[r+2],s[r+3]);if("c"==e.name)for(var r=0;r<e.points.length;r+=6){var s=e.points,o=i+s[r+0],a=n+s[r+1],h=i+s[r+2],l=n+s[r+3],c=i+s[r+4],u=n+s[r+5];i=c,n=u,t.bezierCurveTo(o,a,h,l,c,u)}if("C"==e.name)for(var s=e.points,f=e.points.length,r=0;f>r;r+=6)t.bezierCurveTo(s[r+0],s[r+1],s[r+2],s[r+3],s[r+4],s[r+5]);if("l"==e.name)for(var r=0;r<e.points.length;r+=2){var s=e.points,o=i+s[r+0],a=n+s[r+1];i=o,n=a,t.lineTo(o,a)}if("H"==e.name)for(var r=0;r<e.points.length;r++){var s=e.points,o=s[r+0];i=o,t.lineTo(o,n)}if("V"==e.name)for(var r=0;r<e.points.length;r++){var s=e.points,a=s[r+0];n=a,t.lineTo(i,a)}if("L"==e.name)for(var r=0;r<e.points.length;r+=2){var s=e.points,o=s[r+0],a=s[r+1];i=o,n=a,t.lineTo(o,a)}"z"==e.name&&t.closePath()})},t.findDimensions=function(){if(this._limits)return this._limits;var t,i,n,e,r,s,o=function(r,s){"undefined"==typeof t&&(t=r,n=r,i=s,e=s),t=Math.min(t,r),i=Math.min(i,s),n=Math.max(n,r),e=Math.max(e,s)};return this._all.forEach(function(t){if("M"==t.name&&(r=t.points[0],s=t.points[1],o(r,s)),"m"==t.name&&(r+=t.points[0],s+=t.points[1],o(r,s)),"c"==t.name)for(var i=0;i<t.points.length;i+=6){var n=t.points,e=r+n[i+0],a=s+n[i+1],h=r+n[i+2],l=s+n[i+3],f=r+n[i+4],c=s+n[i+5];o(e,a),o(h,l),o(f,c),r=f,s=c}if("C"==t.name)for(var n=t.points,u=t.points.length,i=0;u>i;i+=6)o(n[i+0],n[i+1]),o(n[i+2],n[i+3]),o(n[i+4],n[i+5]);if("l"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points,e=r+n[i+0],a=s+n[i+1];r=e,s=a,o(r,s)}if("L"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points,e=n[i+0],a=n[i+1];r=e,s=a,o(r,s)}}),this._limits=[t,i,n,e],this._limits},t.fitPathInto=function(t,i){for(var n=this.findDimensions(),e=!0,r=0;4>r;r++)(n[r]<0||n[r]>t)&&(e=!1);var s=Math.abs(n[2]-n[0]),o=Math.abs(n[3]-n[1]),a=!1;Math.abs(n[3])<Math.abs(n[1])&&(a=!0);var h=t/s,l=i/o,f=-n[0],c=-n[1],u=Math.min(h,l),p=u;a&&(p=-p,c=-n[3]);var y=function(t){return(t+f)*u},m=function(t){return(t+c)*p};this._all.forEach(function(t){if("M"==t.name&&(t.points[0]=y(t.points[0]),t.points[1]=m(t.points[1])),"m"==t.name&&(t.points[0]*=u,t.points[1]*=p),"L"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points;n[i+0]=y(n[i+0]),n[i+1]=m(n[i+1])}if("c"==t.name)for(var i=0;i<t.points.length;i+=6){var n=t.points;n[i+0]*=u,n[i+2]*=u,n[i+4]*=u,n[i+1]*=p,n[i+3]*=p,n[i+5]*=p}if("C"==t.name)for(var n=t.points,e=t.points.length,i=0;e>i;i+=6)n[i+0]=y(n[i+0]),n[i+2]=y(n[i+2]),n[i+4]=y(n[i+4]),n[i+1]=m(n[i+1]),n[i+3]=m(n[i+3]),n[i+5]=m(n[i+5]);if("Q"==t.name)for(var n=t.points,e=t.points.length,i=0;e>i;i+=4)n[i+0]=y(n[i+0]),n[i+2]=y(n[i+2]),n[i+1]=m(n[i+1]),n[i+3]=m(n[i+3]);if("l"==t.name)for(var i=0;i<t.points.length;i+=2){var n=t.points;n[i+0]*=u,n[i+1]*=p}}),this._limits=null},t.forCmds=function(t){this._all.forEach(t)},t.fromBezierArray=function(t){{var i,n=t.length;this._all}this._all=[];for(var i=0;n>i;i++){var e=t[i];if(0==i){var r={name:"M",points:[e.point_x(0),e.point_y(0)]};this._all.push(r)}var r={name:"C",points:[e.point_x(1),e.point_y(1),e.point_x(2),e.point_y(2),e.point_x(3),e.point_y(3)]};this._all.push(r)}this.saveToOriginals()},t.getCommands=function(){return this._all},t.getPath=function(t){return this._all[t]},t.getSegmentCount=function(){var t=this._all.length;return"z"==this._all[t-1].name&&t--,t},t.getSubPaths=function(){return this._subPaths},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,n||(n={})}),t.initCmd=function(t){return this._activeCmd={name:t,points:[]},this._all.push(this._activeCmd),this._activeCmd},t.inverse=function(){var t,i=this.originals(),n=i.length;this._all.reverse();var i=(this._all,this._all),e=[],r=function(t,i){for(var n=[],e=t.points.length/2,r=t.points.length-4;e>0;){if(1==e){if(!i)return n;r=i.points.length-2,n.push(i.points[r]),n.push(i.points[r+1])}else n.push(t.points[r]),n.push(t.points[r+1]),r-=2;e--}return n};"z"==i[0].name&&i.shift();for(var t=0;n>t;t++){{var s,o=i[t];i[t],i[t+1]}if(!o)break;if(t>0&&(s=i[t-1]),0==t){var a=o.points.length-2,h={name:"M",points:[o.points[a],o.points[a+1]]};e.push(h)}else{var h={name:s.name,points:r(s,o)};e.push(h)}}var h={name:"z",points:[]};e.push(h),this._all=e},t.makePathAbsolute=function(){var t,i,n,e,r=!0,s=function(){r&&(n=t,e=i);var s=t-n,o=i-e;return{x:t+s,y:i+o}};this._all.forEach(function(o){if("M"==o.name&&(t=o.points[0],i=o.points[1],r=!0),"L"==o.name&&(t=o.points[0],i=o.points[1],r=!0),"m"==o.name&&(t+=o.points[0],i+=o.points[1],o.points[0]=t,o.points[1]=i,o.name="M",r=!0),"q"==o.name){for(var a=0;a<o.points.length;a+=4){var h=o.points;h[a+0]=t+h[a+0],h[a+1]=i+h[a+1],h[a+2]=t+h[a+2],h[a+3]=i+h[a+3],t=h[a+2],i=h[a+3],o.name="Q"}r=!0}if("C"==o.name){var h=o.points;n=h[2],e=h[3],t=h[4],i=h[5],r=!1}if("c"==o.name){for(var a=0;a<o.points.length;a+=6){var h=o.points;h[a+0]=t+h[a+0],h[a+1]=i+h[a+1],h[a+2]=t+h[a+2],h[a+3]=i+h[a+3],h[a+4]=t+h[a+4],h[a+5]=i+h[a+5],t=h[a+4],i=h[a+5],n=h[a+2],e=h[a+3],o.name="C"}r=!1}if("S"==o.name){var h=o.points,l=s(),f=[];f[0]=l.x,f[1]=l.y,f[2]=h[0],f[3]=h[1],f[4]=h[2],f[5]=h[3],t=f[4],i=f[5],n=f[2],e=f[3],o.name="C",o.points=f,r=!1}if("s"==o.name){var h=o.points,l=s(),f=[];f[0]=l.x,f[1]=l.y,f[2]=t+h[0],f[3]=i+h[1],f[4]=t+h[2],f[5]=i+h[3],t=f[4],i=f[5],n=f[2],e=f[3],o.name="C",o.points=f,r=!1}if("h"==o.name){r=!0;for(var a=0;a<o.points.length;a++){var h=o.points,c=t+h[a+0];return t=c,h[a+0]=c,o.points=[c,i],void(o.name="L")}}if("H"==o.name){r=!0;for(var a=0;a<o.points.length;a++){var h=o.points,c=h[a+0];return t=c,h[a+0]=c,o.points=[c,i],void(o.name="L")}}if("V"==o.name){r=!0;for(var a=0;a<o.points.length;a++){var h=o.points,u=h[a+0];return i=u,o.points=[t,u],void(o.name="L")}}if("v"==o.name){r=!0;for(var a=0;a<o.points.length;a++){var h=o.points,u=i+h[a+0];return i=u,o.points=[t,u],void(o.name="L")}}if("l"==o.name){r=!0;for(var a=0;a<o.points.length;a+=2){var h=o.points,c=t+h[a+0],u=i+h[a+1];t=c,i=u,h[a+0]=c,h[a+1]=u,o.name="L"}}})},t.normalize=function(){this.makePathAbsolute(),this.fitPathInto(800,800)},t.originals=function(){return this._original||(this._original=JSON.parse(JSON.stringify(this._all))),this._original},t.parse=function(t){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,this._usedCommands={},t||(t="M25.979,12.896 L 5.979,12.896,5.979,19.562,25.979,19.562z");var i=t,n=0,e=1e4;for(this._subPaths=t.split("M"),this._subIndex=0;(i=this.popCommand(i))&&0!=i.length&&i.length!=n&&!(e--<0);)n=i.length;return this._all},t.path=function(){return this._all},t.pathFunction=function(){},t.popCommand=function(t){t=t.trim();var i=t.charAt(0),n=null;if("M"==i&&(n=this.initCmd(i),t=t.substring(1)),"m"==i&&(n=this.initCmd(i),t=t.substring(1)),"Q"==i&&(n=this.initCmd(i),t=t.substring(1)),"q"==i&&(n=this.initCmd(i),t=t.substring(1)),"S"==i&&(n=this.initCmd(i),t=t.substring(1)),"s"==i&&(n=this.initCmd(i),t=t.substring(1)),"C"==i&&(n=this.initCmd(i),t=t.substring(1)),"c"==i&&(n=this.initCmd(i),t=t.substring(1)),"H"==i&&(n=this.initCmd(i),t=t.substring(1)),"h"==i&&(n=this.initCmd(i),t=t.substring(1)),"V"==i&&(n=this.initCmd(i),t=t.substring(1)),"v"==i&&(n=this.initCmd(i),t=t.substring(1)),"L"==i&&(n=this.initCmd(i),t=t.substring(1)),"l"==i&&(n=this.initCmd(i),t=t.substring(1)),"Z"==i&&(n=this.initCmd(i),t=t.substring(1)),"z"==i&&(n=this.initCmd(i),t=t.substring(1)),n){this._usedCommands[i]="true",t=t.trim();for(var e=!0;e&&t.length>0;){var r=t.charAt(0);","==r&&(t=t.substring(1),t=t.trim());for(var s=["-","1","2","3","4","5","6","7","8","9","0","."],o="",a=0;s.indexOf(t.charAt(0))>=0&&!("-"==t.charAt(0)&&(a++,a>1));)o+=t.charAt(0),t=t.substring(1),a=1;if(!(o.length>0))break;n.points.push(parseFloat(o)),t=t.trim()}}return n||(console.error("No command found for"),console.error(t)),this._activeCmd=n,this._stringLeft=t,t},t.relativePosition=function(t){var i=this.toBezierArray(),n=i.length,e=n*t,r=Math.floor(e);r>=n&&(r=n-1),0>r&&(r=0);var s=i[r],o=1/n,a=r/n,h=t,l=h-a,f=l/o,c={x:0,y:0,normal:{x:0,y:0}};c.x=s.x(f),c.y=s.y(f);var u=s.tangent(f,!0);return c.normal.x=u.x,c.normal.y=u.y,c},t.replacePartWith=function(t,n,e){var r=function(t,n){var e=a();e.parse(t),e.makePathAbsolute();var r=e.toBezierArray();e.fromBezierArray(r),n&&e.inverse();var s=e.toQuaternionPath(),o=function(t,n){var e=pathIterator(s),r=e.endPoint(),o="M 0 0 "+e.toSvgPath(),a=t;if(0==n.x&&0==n.y)return"";var h=Math.sqrt(r.x*r.x+r.y*r.y),l=Math.sqrt(n.x*n.x+n.y*n.y),f=l/h;if(0==h)return o;var c=i(),u=c.angleBetween(r,n),o=e.toSvgPath(a,quaternion().rotate(u),function(t){return t.d=t.d*f,t});return o};return o},s=this.getPath(t);s.replaceFunction=r(n,e)},t.saveToOriginals=function(){this._original=JSON.parse(JSON.stringify(this._all))},t.scaleFactor=function(t,i){var n=this.findDimensions(),e=Math.abs(n[2]-n[0]),r=Math.abs(n[3]-n[1]),s=t/e,o=i/r,a=Math.min(s,o);return a},t.svgString=function(){var t,i,n="";return this._all.forEach(function(e){if("M"==e.name&&(t=e.points[0],i=e.points[1],n+="M"+t+","+i+" "),"m"==e.name&&(t+=e.points[0],i+=e.points[1],n+="M"+t+","+i+" "),"q"==e.name){n+="Q";for(var r=0;r<e.points.length;r+=4){var s=e.points,o=t+s[r+0],a=i+s[r+1],h=t+s[r+2],l=i+s[r+3];t=h,i=l,n+=o+","+a+" "+h+","+l+" "}}if("Q"==e.name){var s=e.points,f=e.points.length;n+="Q";for(var r=0;f>r;r+=4){var o=s[r+0],a=s[r+1],h=s[r+2],l=s[r+3];t=h,i=l,n+=o+","+a+" "+h+","+l+" "}}if("c"==e.name){n+="C";for(var r=0;r<e.points.length;r+=6){var s=e.points,o=t+s[r+0],a=i+s[r+1],h=t+s[r+2],l=i+s[r+3],c=t+s[r+4],u=i+s[r+5];t=c,i=u,n+=o+","+a+" "+h+","+l+" "+c+","+u+" "}}if("C"==e.name){var s=e.points,f=e.points.length;if(e.replaceFunction){for(var p={x:t,y:i},r=0;f>r;r+=6)t=s[r+4],i=s[r+5];var y={x:t-p.x,y:i-p.y},m=e.replaceFunction(p,y);console.log("The inserted path ",m),n+=" "+m+" "}else{n+="C";for(var r=0;f>r;r+=6)n+=s[r+0]+","+s[r+1]+" "+s[r+2]+","+s[r+3]+" "+s[r+4]+","+s[r+5]+" ",t=s[r+4],i=s[r+5]}}if("l"==e.name){n+="L";for(var r=0;r<e.points.length;r+=2){var s=e.points,o=t+s[r+0],a=i+s[r+1];t=o,i=a,n+=o+","+a+" "}}if("H"==e.name){n+="L";for(var r=0;r<e.points.length;r++){var s=e.points,o=s[r+0];t=o,n+=o+","+i+" "}}if("V"==e.name){n+="L";for(var r=0;r<e.points.length;r++){var s=e.points,a=s[r+0];i=a,n+=t+","+a+" "}}if("L"==e.name)if(e.replaceFunction){for(var p={x:t,y:i},r=0;r<e.points.length;r+=2){var s=e.points,o=s[r+0],a=s[r+1];t=o,i=a}var y={x:t-p.x,y:i-p.y},m=e.replaceFunction(p,y);console.log("The inserted path ",m),n+=" "+m+" "}else{n+="L";
for(var r=0;r<e.points.length;r+=2){var s=e.points,o=s[r+0],a=s[r+1];t=o,i=a,n+=o+","+a+" "}}"z"==e.name&&(n+="z")}),n},t.toBezierArray=function(){var t,i,n="",e=[];return this._all.forEach(function(r){if("M"==r.name&&(t=r.points[0],i=r.points[1]),"Q"==r.name)for(var s=r.points,o=r.points.length,a=0;o>a;a+=4){var h=s[a+0],l=s[a+1],f=s[a+2],c=s[a+3],u=new jsBezierCurve;u.fromQuadCurve({x:t,y:i},{x:h,y:l},{x:f,y:c}),e.push(u),t=f,i=c}if("C"==r.name)for(var s=r.points,o=r.points.length,a=0;o>a;a+=6){var h=s[a+0],l=s[a+1],f=s[a+2],c=s[a+3],p=s[a+4],y=s[a+5],u=new jsBezierCurve;u.fromPoints({x:t,y:i},{x:h,y:l},{x:f,y:c},{x:p,y:y}),e.push(u),t=p,i=y}if("L"==r.name){n+="L";for(var a=0;a<r.points.length;a+=2){var s=r.points,h=s[a+0],l=s[a+1],u=new jsBezierCurve;u.fromLine({x:t,y:i},{x:h,y:l}),e.push(u),t=h,i=l}}}),e},t.toQuaternionPath=function(){var t=!0,n={x:0,y:0},e={x:100,y:0},r={x:100,y:0},s=i(),o=[];return this.forCmds(function(i){var a={cmd:i.name,path:[]},h=function(i,o){e.x=i-n.x,e.y=o-n.y;var h=Math.sqrt(e.x*e.x+e.y*e.y);0==h&&(e.x+=.2,e.y+=.2,i+=.02,o+=.02,h=Math.sqrt(e.x*e.x+e.y*e.y));var l=s.angleBetween(r,e),f=quaternion();f.setFromAxisRotation({x:0,y:0,z:1},l),t||a.path.push({q:f,d:h}),t=!1,n.x=i,n.y=o,r.x=e.x,r.y=e.y};"M"==i.name&&h(i.points[0],i.points[1]),"L"==i.name&&h(i.points[0],i.points[1]),"Q"==i.name&&(h(i.points[0],i.points[1]),h(i.points[2],i.points[3])),"C"==i.name&&(h(i.points[0],i.points[1]),h(i.points[2],i.points[3]),h(i.points[4],i.points[5])),a.path.length&&o.push(a)}),o},t.transformPoints=function(t){for(var i,n=this.originals(),e={x:0,y:0},r=n.length,i=(this._all,0);r>i;i++){var s=n[i],o=this._all[i];if(!s)return;if("M"==s.name&&(e.x=s.points[0],e.y=s.points[1],t(e),o.points[0]=e.x,o.points[1]=e.y),"Q"==s.name)for(var a=s.points,h=o.points,l=s.points.length,f=0;l>f;f+=4)e.x=a[f+0],e.y=a[f+1],t(e),h[f+0]=e.x,h[f+1]=e.y,e.x=a[f+2],e.y=a[f+3],t(e),h[f+2]=e.x,h[f+3]=e.y;if("C"==s.name)for(var a=s.points,h=o.points,l=s.points.length,f=0;l>f;f+=6)e.x=a[f+0],e.y=a[f+1],t(e),h[f+0]=e.x,h[f+1]=e.y,e.x=a[f+2],e.y=a[f+3],t(e),h[f+2]=e.x,h[f+3]=e.y,e.x=a[f+4],e.y=a[f+5],t(e),h[f+4]=e.x,h[f+5]=e.y;if("L"==s.name)for(var f=0;f<s.points.length;f+=2){var a=s.points,h=o.points;e.x=a[f+0],e.y=a[f+1],t(e),h[f+0]=e.x,h[f+1]=e.y}}}}(this)},a=function(t,i,n,e,r,s,o,h){if(!(this instanceof a))return new a(t,i,n,e,r,s,o,h);var l=[t,i,n,e,r,s,o,h];if(this.__factoryClass){var f,c=this;if(this.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"[object Function]"==Object.prototype.toString.call(f)){if(f._classInfo.name!=a._classInfo.name)return new f(t,i,n,e,r,s,o,h)}else if(f)return f}if(this.__traitInit){var c=this;this.__traitInit.forEach(function(t){t.apply(c,l)})}else"function"==typeof this.init&&this.init.apply(this,l)};a._classInfo={name:"svgPathParser"},a.prototype=new o,"undefined"!=typeof window&&(window.svgPathParser=a),"undefined"!=typeof window&&(window.svgPathParser_prototype=o),function(t){var i,n,r,s;t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(n={},r={},s={},i=!0)}),t.promiseImage=function(t){var i=e();if(n[t])return i.resolve(n[t]),r[t]=!1,i;if(s[t]||(s[t]=[]),s[t].push(i),r[t])return i;r[t]=!0;var o=new Image;return o.addEventListener("load",function(){n[t]=o;for(var i;i=s[t].pop();)i.resolve(o);r[t]=!1}),o.src=t,i}}(this),function(t){t.add=function(t,i){return i?(this.hasOwnProperty("_inserts")||(this._inserts={}),this._inserts[t]||(this._inserts[t]=[]),i.parent(this),void this._inserts[t].push(i)):void this.add("children",t)},t.addClipMask=function(t){this.hasOwnProperty("_clipMasks")||(this._clipMasks=[]),this._clipMasks.push(t)},t.autoRender=function(){if(!this._autoRender){var t=this;this._autoRender=!0,s().every(1/60,function(){t.isDirty()&&(t.reset(),t.exec(),t.isDirty(!1))})}},t.clear=function(){this._commands=[],this._inserts={}},t.createColorIndex=function(){return ocColorIndex()},t.createHandle=function(t){this._colorIndex||(this._colorIndex=this.createColorIndex());var i=this._colorIndex,n=function(t,n,e,r,s,o){var a=t.create("handleCtx");a.save(),a.beginPath(),o._x=n,o._y=e,o.ctx=a,o.color=s,o.position=a.create("position"),o.position.translate(n,e),a.insert("shape"),a.add("shape",r),a.fillStyle(s),a.fill(),a.restore(),a.stroke(),i.add(s,o)},e=_e();n(this,t.x||0,t.y||0,t.shape,t.color,t.obj);var r=this;if(e._handleData=t,t.obj.handleObj=e,e.moveToPoint=function(i){t.obj.position.replace("translate",i.x,i.y)},!this._dragSet&&this._canvas){var s=this._canvas;this._dragSet=!0;var o;s.draggable(function(t,n){if(o=i.find(r.getPixel(n.x,n.y))){var e=o.handleObj;o.ctx.replace("fillStyle","yellow"),e.trigger("startdrag",n)}},function(t,i){if(o){var n=o.handleObj;o.position.replace("translate",o._x+i.dx,o._y+i.dy),o.ctx.replace("fillStyle","yellow"),n.trigger("drag",i)}},function(t,i){if(o){var n=o.handleObj;o.ctx.replace("fillStyle",o.color),o._x=o._x+i.dx,o._y=o._y+i.dy,n.trigger("enddrag",i)}})}return e},t.exec=function(t){t||(t=this._ctx),t._ctx&&(t=t._ctx);var i=this;this._commands.forEach(function(n){var e=n[0],r=n[1];if("circle"==e){var s=r[0],o=r[1],a=r[2];return void t.arc(s,o,a,0,2*Math.PI,!1)}if("drawImage"==e){var h=r[0];return void(h===Object(h)?t[e].apply(t,r):i.promiseImage(h).then(function(i){console.log("image loaded ok"),console.log(i),console.log(typeof i),r[0]=i,t[e].apply(t,r)}))}if("insert"==e)return void i.forInserts(r[0],function(i){i.exec(t)});if("clipMask"==e)return void i.forClipMasks(function(i){i.exec(t)});if("children"==e)return void i.forChildren(function(i){i.exec(t)});if("setProperty"==e){var l=r[0],f=r[1];t[l]=f}else t[e].apply(t,r)})},t.execFn=function(t,i){var n=i||this._transform;i||n.reset();var e=this;this._commands.forEach(function(i){var r=i[0],s=i[1];if("insert"==r)return void e.forInserts(s[0],function(i){i.execFn(t,n)});if("clipMask"==r)return void e.forClipMasks(function(i){i.execFn(t,n)});if("children"==r)return void e.forChildren(function(i){i.execFn(t,n)});if("setProperty"==r){var o=s[0],a=s[1];t(o,s,n),n[o]&&n[o].apply(n,[a])}else n[r]&&n[r].apply(n,s),t(r,s,n)})},t.forChildren=function(t){this.forInserts("children",t)},t.forClipMasks=function(t){this.forInserts("clipMask",t)},t.forInserts=function(t,i){this._inserts&&this._inserts[t]&&this._inserts[t].forEach(i)},t.getPixel=function(t,i){return this._ctx?(data=this._ctx.getImageData(t,i,1,1).data,data?{x:t,y:i,r:data[0],g:data[1],b:data[2],a:data[3]}:null):null},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._commands||(this._commands=[]),this._undoBuffer=[],this._ctx=t,this._transform=new i;var n=this,e=["rect","fillRect","strokeRect","clearRect","fill","stroke","beginPath","moveTo","closePath","lineTo","clip","quadraticCurveTo","bezierCurveTo","arc","arcTo","scale","rotate","translate","transform","setTransform","fillText","strokeText","createImageData","putImageData","drawImage","circle","save","restore","setTransform"],r=["createLinearGradient","createPattern","createRadialGradient","addColorStop","isPointInPath","measureText","getImageData","toDataURL"],o=["width","height","data"],a=["globalAlpha","fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","font","textAlign","textBaseline","lineCap","lineJoin","lineWidth","miterLimit"],h=(new Date).getTime();s().onFrame(function(){h=(new Date).getTime()}),n.insert=function(){var t=Array.prototype.slice.call(arguments);return n._commands.push(["insert",t,h]),canvasContext()},n.create=function(){var t=Array.prototype.slice.call(arguments);n._commands.push(["insert",t,h]);var i=canvasContext();return n.add(t[0],i),i},n.clipMask=function(){n.insert("clipMask")},n.children=function(){n.insert("children")},e.forEach(function(t){n[t]=function(){n._undoBuffer=[];var i=Array.prototype.slice.call(arguments);n._commands.push([t,i,h])}}),r.forEach(function(i){n[i]=function(){var n=Array.prototype.slice.call(arguments);return t[i].apply(t,n)}}),o.forEach(function(t){n[t]=function(){return n._ctx[t]}}),a.forEach(function(t){n[t]=function(i){return"undefined"!=typeof i?(n._commands.push(["setProperty",[t,i],h]),n):n._ctx[t]}})}),t.isDirty=function(t){if("undefined"!=typeof t){this._dirty=t;var i;return(i=this.parent())&&i.isDirty(!0),this}return this._dirty},t.paintHead=function(){return ocPaintHead(this)},t.parent=function(t){return"undefined"!=typeof t?(this._parent=t,this):this._parent},t.redo=function(){if(this._commands){var t,i=this._undoBuffer.pop();if(i){for(t=i[2];i&&i[2]==t;)this._commands.push(i),i=this._undoBuffer.pop();i&&this._undoBuffer.push(i)}}},t.renderPath=function(t,i,n){var e=a();e.parse(t),e.makePathAbsolute(),e.fitPathInto(i,n),e.drawPath(this)},t.renderSvg=function(t){var i,n=[],e=null,r=null,s=!1,o=this,a="black";i=t?t.g():_e().g();return o.execFn(function(t,o,h){if("beginPath"==t&&(n=[],s=!1,a="none",e=i.path("",{d:"",stroke:h.getStyle("strokeStyle"),fill:h.getStyle("fillStyle"),"fill-opacity":h.getStyle("globalAlpha")})),"drawImage"==t&&(n=[],e=i.image("",{"xlink:href":o[0],x:o[1],y:o[2],width:o[3],height:o[4]})),"circle"==t&&(n=[],e=i.circle("",{cx:o[0],cy:o[1],r:o[2],transform:h.getSvgTransform(),stroke:h.getStyle("strokeStyle"),fill:h.getStyle("fillStyle")})),"rect"==t&&(n=[],e=i.rect("",{x:o[0],y:o[1],width:o[2],height:o[3],transform:h.getSvgTransform(),stroke:h.getStyle("strokeStyle"),fill:h.getStyle("fillStyle")})),"arc"==t){var l=h.transformPoint(o[0],o[1]),f=l.x,c=l.y,u=h.transformDelta(o[2],o[2]);c-=u.y,n.push("M "+f+" "+c),n.push("A "+u.x+","+u.y+" 0 1,0 "+(f+.1)+" "+c+" ")}if("fillText"==t){var p=o[0],l=h.transformPoint(o[1],o[2]),f=l.x,c=l.y,u=h.transformDelta(parseInt(h.getStyle("font-size")),parseInt(h.getStyle("font-size"))),y=u.x,m=h.getStyle("font-family");e=i.svg_text("",{x:o[1],y:o[2]}),e.text(p),e.q.attr("font-size",parseInt(h.getStyle("font-size"))),e.q.attr("font-family",m),e.q.attr("fill",h.getStyle("fillStyle")),e.q.attr("fill-opacity",h.getStyle("globalAlpha")),e.q.attr("transform",h.getSvgTransform()),s=!1,n=[],e=null}if("strokeText"==t){var p=o[0],l=h.transformPoint(o[1],o[2]),f=l.x,c=l.y,u=h.transformDelta(parseInt(h.getStyle("font-size")),parseInt(h.getStyle("font-size"))),y=u.x,m=h.getStyle("font-family");e=i.svg_text("",{x:f,y:c}),e.text(p),e.q.attr("fill","none"),e.q.attr("font-size",y),e.q.attr("font-family",m),e.q.attr("stroke",h.getStyle("strokeStyle")),e.q.attr("stroke-opacity",h.getStyle("globalAlpha")),s=!1,n=[],e=null}if("quadraticCurveTo"==t){var _=h._point.tx0,v=h._point.ty0,l=h.transformPoint(o[0],o[1]),d=l.x,x=l.y,l=h.transformPoint(o[2],o[3]),g=l.x,w=l.y;0==n.length&&n.push("M "+_+" "+v),n.push("Q "+d+" "+x+" "+g+" "+w+" ")}if("bezierCurveTo"==t){var _=h._point.tx0,v=h._point.ty0,l=h.transformPoint(o[0],o[1]),d=l.x,x=l.y,l=h.transformPoint(o[2],o[3]),g=l.x,w=l.y,l=h.transformPoint(o[4],o[5]),I=l.x,C=l.y;0==n.length&&n.push("M "+_+" "+v),n.push("C "+d+" "+x+" "+g+" "+w+" "+I+" "+C+" ")}if("moveTo"==t){var P=h._point.tx1,b=h._point.ty1,_=h._point.tx0,v=h._point.ty0;n.push("M "+P+" "+b)}if("lineTo"==t){var P=h._point.tx1,b=h._point.ty1,_=h._point.tx0,v=h._point.ty0;console.log("lineTo",_,v,P,b),0==n.length&&n.push("M "+_+" "+v),n.push("L "+P+" "+b)}if("stroke"==t){e&&(r=e),e=null,a="black";var S=n.join(" ");console.log("path",S),n.length&&r.q.attr("d",S),console.log("new way"),r.attr({stroke:h.getStyle("strokeStyle"),"stroke-opacity":h.getStyle("globalAlpha"),"stroke-width":h.transformDelta(h.getStyle("lineWidth")>>0,h.getStyle("lineWidth")>>0).x||1}),s=!0}if("fill"==t){e&&(r=e),e=null,s||n.push("z");var S=n.join(" ");console.log("path",S),n.length&&r.q.attr("d",S),r.q.attr("stroke",h.getStyle("strokeStyle")),r.q.attr("fill",h.getStyle("fillStyle")),r.q.attr("fill-opacity",h.getStyle("globalAlpha")),s=!0}}),i},t.replace=function(t){var i=Array.prototype.slice.call(arguments);i.shift();var n=this;this._commands.forEach(function(e){var r=e[0];r==t&&(e[1]=i,n.isDirty(!0)),"setProperty"==r&&e[1][0]==t&&(e[1][1]=i[0],n.isDirty(!0))})},t.reset=function(){var t=this._ctx;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height)},t.serialize=function(){var t={};t.commands=this._commands,t.inserts={};var i=this._inserts;if(i)for(var n in i)if(i.hasOwnProperty(n)){var e=[];i[n].forEach(function(t){e.push(t.serialize())}),t.inserts[n]=e}return t},t.set=function(t,i){return i?(this.hasOwnProperty("_inserts")||(this._inserts={}),this._inserts[t]||(this._inserts[t]=[]),this._inserts[t].length=0,i.parent(this),void this._inserts[t].push(i)):void this.set("children",t)},t.shadow=function(t,i){this.shadowBlur(t),this.shadowOffsetX(0),this.shadowOffsetY(0),this.shadowColor(i||"#000000")},t.shapes=function(){return ocPathLib(this)},t.svgPathString=function(){var t=[],i=!1,n=this,e="",r="black";return n.execFn(function(n,s,o){if("beginPath"==n&&(t=[],i=!1,r="none"),"arc"==n){var a=o.transformPoint(s[0],s[1]),h=a.x,l=a.y,f=o.transformDelta(s[2],s[2]);l-=f.y,t.push("M "+h+" "+l),t.push("A "+f.x+","+f.y+" 0 1,0 "+(h+.1)+" "+l+" ")}if("quadraticCurveTo"==n){var c=o._point.tx0,u=o._point.ty0,a=o.transformPoint(s[0],s[1]),p=a.x,y=a.y,a=o.transformPoint(s[2],s[3]),m=a.x,_=a.y;0==t.length&&t.push("M "+c+" "+u),t.push("Q "+p+" "+y+" "+m+" "+_+" ")}if("bezierCurveTo"==n){var c=o._point.tx0,u=o._point.ty0,a=o.transformPoint(s[0],s[1]),p=a.x,y=a.y,a=o.transformPoint(s[2],s[3]),m=a.x,_=a.y,a=o.transformPoint(s[4],s[5]),v=a.x,d=a.y;0==t.length&&t.push("M "+c+" "+u),t.push("C "+p+" "+y+" "+m+" "+_+" "+v+" "+d+" ")}if("moveTo"==n){var x=o._point.tx1,g=o._point.ty1,c=o._point.tx0,u=o._point.ty0;t.push("M "+x+" "+g)}if("lineTo"==n){var x=o._point.tx1,g=o._point.ty1,c=o._point.tx0,u=o._point.ty0;0==t.length&&t.push("M "+c+" "+u),t.push("L "+x+" "+g)}"stroke"==n&&t.length>0&&(e||(e=t.join(" "))),"fill"==n&&t.length>0&&(e||(e=t.join(" ")))}),t.length>0&&(e||(e=t.join(" "))),e},t.undo=function(){if(this._commands){var t,i=this._commands.pop();if(i){for(t=i[2];i&&i[2]==t;)this._undoBuffer.push(i),i=this._commands.pop();i&&this._commands.push(i)}console.log(this._commands)}},t.unserialize=function(t){var i=canvasContext();i._commands=t.commands;var n=t.inserts;if(n){i._inserts={};for(var e in n)if(n.hasOwnProperty(e)){var r=[];n[e].forEach(function(t){r.push(canvasContext().unserialize(t))}),i._inserts[e]=r}}return i}}(this)},canvasContext=function(t,i,n,e,r,s,o,a){if(!(this instanceof canvasContext))return new canvasContext(t,i,n,e,r,s,o,a);var h=[t,i,n,e,r,s,o,a];if(this.__factoryClass){var l,f=this;if(this.__factoryClass.forEach(function(t){l=t.apply(f,h)}),"[object Function]"==Object.prototype.toString.call(l)){if(l._classInfo.name!=canvasContext._classInfo.name)return new l(t,i,n,e,r,s,o,a)}else if(l)return l}if(this.__traitInit){var f=this;this.__traitInit.forEach(function(t){t.apply(f,h)})}else"function"==typeof this.init&&this.init.apply(this,h)};canvasContext._classInfo={name:"canvasContext"},canvasContext.prototype=new canvasContext_prototype,"undefined"!=typeof window&&(window.canvasContext=canvasContext),"undefined"!=typeof window&&(window.canvasContext_prototype=canvasContext_prototype);